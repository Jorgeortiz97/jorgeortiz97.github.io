<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gremios - Juego de Cartas</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#c9a961">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gremios">
    <meta name="description" content="Juego de cartas estrat√©gico de gremios, expediciones y construcci√≥n">

    <!-- Icons -->
    <link rel="icon" href="https://elenport.es/wp-content/uploads/cropped-elenport_favicon-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://elenport.es/wp-content/uploads/cropped-elenport_favicon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="https://elenport.es/wp-content/uploads/cropped-elenport_favicon-180x180.png" />
    <link rel="apple-touch-icon" href="resources/other/Badge.png" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="css/styles.css?v=2">
</head>
<body>
    <div id="game-container">
        <!-- Main Game Area - 4 Column Layout -->
        <main id="game-board">
            <!-- Column 1: Human Player (Left) -->
            <section id="human-column">
                <!-- Human Player Info and Resources -->
                <div id="player-human" class="player-zone active-player">
                    <!-- Player Info View (shown at top, always visible) -->
                    <div id="player-info-view" class="player-info-view hidden">
                        <div class="player-header">
                            <h3 class="player-name">
                                T√∫
                                <span class="emblem-badge emblem-badge-inline hidden" title="Emblema del Descubridor (+1 VP)">üèÜ</span>
                            </h3>
                            <div class="player-coins">
                                <span class="coin-count">3</span> <img src="resources/other/gold.png" class="coin-icon coin-image" alt="üí∞">
                            </div>
                            <div class="player-vp">
                                <span class="vp-count">0</span> VP
                            </div>
                        </div>
                        <div class="player-character-and-resources">
                            <div class="player-character">
                            <button id="select-character-btn" class="btn-primary">Seleccionar Personaje</button>
                            <div class="character-info"></div>
                        </div>
                        <div class="player-resources">
                            <!-- Row 1: Lands + Treasures -->
                            <div class="resource-row lands-row">
                                <div class="resource-item">
                                    <img src="resources/other/Land.png" class="resource-icon-large" alt="Lands" title="Tierras">
                                    <span class="resource-count lands-count">0</span>
                                </div>
                                <div class="resource-item">
                                    <img src="resources/other/Cultivated_Land.png" class="resource-icon-large" alt="Cultivated" title="Tierras Cultivadas">
                                    <span class="resource-count cultivated-count">0</span>
                                </div>
                                <div class="resource-item">
                                    <img src="resources/other/Treasure.png" class="resource-icon-large" alt="Treasures" title="Tesoros">
                                    <span class="resource-count treasures-count">0</span>
                                </div>
                            </div>

                            <!-- Row 2: Inns -->
                            <div class="resource-row inns-row">
                                <div class="resource-item">
                                    <img src="resources/other/Inn.png" class="resource-icon-large" alt="Inns" title="Posadas">
                                    <span class="resource-count inns-count">0</span>
                                </div>
                                <div class="resource-item">
                                    <img src="resources/other/Destroyed_Inn.png" class="resource-icon-large" alt="Destroyed" title="Posadas Destruidas">
                                    <span class="resource-count destroyed-count">0</span>
                                </div>
                            </div>

                            <!-- Row 3: Treasure Breakdown -->
                            <div id="human-treasures-detail" class="resource-row treasure-breakdown-row">
                                <!-- Treasure breakdown will be populated by JavaScript -->
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Character Selection View (shown below player info during selection) -->
                    <div id="character-selection-view" class="character-selection-view">
                        <div id="character-options-inline"></div>
                    </div>
                </div>

                <!-- Row 2: Actions -->
                <div class="player-actions-section player-zone">
                    <h4>Acciones</h4>
                    <div class="actions-grid">
                        <button class="action-btn" data-action="invest-guild" disabled>
                            <span class="action-text">Invertir en Gremio (2)</span>
                        </button>
                        <button class="action-btn" data-action="invest-expedition" disabled>
                            <span class="action-text">Invertir en Expedici√≥n (2)</span>
                        </button>
                        <button class="action-btn" data-action="buy-land" disabled>
                            <span class="action-text">Comprar Tierra (2)</span>
                        </button>
                        <button class="action-btn" data-action="cultivate-land" disabled>
                            <span class="action-text">Cultivar Tierra (1)</span>
                        </button>
                        <button class="action-btn" data-action="build-inn" disabled>
                            <span class="action-text">Construir Posada (6)</span>
                        </button>
                        <button class="action-btn" data-action="repair-inn" disabled>
                            <span class="action-text">Reparar Posada (1)</span>
                        </button>
                        <button class="action-btn character-ability character-ability-hidden" data-action="cause-mutiny" disabled>
                            <span class="action-text">Causar Mot√≠n (1)</span>
                        </button>
                        <button class="action-btn character-ability character-ability-hidden" data-action="buy-treasure" disabled>
                            <span class="action-text">Comprar Tesoro (4)</span>
                        </button>
                        <button class="action-btn character-ability character-ability-hidden" data-action="sell-treasure-artisan" disabled>
                            <span class="action-text">Vender Tesoro (4)</span>
                        </button>
                    </div>
                    <button class="action-btn btn-end-turn" data-action="end-turn" disabled>Terminar Turno</button>

                    <!-- Fullscreen and Help buttons -->
                    <div class="utility-buttons-row">
                        <button id="fullscreen-btn" class="action-btn btn-utility" title="Pantalla completa">
                            <span class="fullscreen-icon">‚§¢</span><span class="btn-text-large"> Pantalla Completa</span>
                        </button>
                        <button id="help-btn" class="action-btn btn-utility" title="Ayuda">
                            <span class="help-icon">?</span><span class="btn-text-large"> Ayuda</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Column 2: Game Board (Center) -->
            <section id="board-column">
                <div id="guilds-grid">
                    <!-- Current Event Card -->
                    <div id="current-event-card" class="event-card-on-board">
                        <div class="event-card-content">
                            <div class="event-name">Evento Actual</div>
                            <div class="event-deck-count">Cartas: <span>0</span></div>
                        </div>
                    </div>

                    <!-- Previous Event Card (Black & White) -->
                    <div id="previous-event-card" class="event-card-on-board previous-event">
                        <div class="event-card-content">
                            <div class="event-name">Evento Anterior</div>
                        </div>
                    </div>

                    <!-- Expedition Card -->
                    <div id="expedition-card">
                        <div class="investment-slots"></div>
                    </div>

                    <!-- Dice Area -->
                    <aside id="dice-area">
                        <h3>Dados</h3>
                        <div id="dice-display">
                            <div class="die-container" id="die1-container">
                                <div class="die" id="die1">
                                    <div class="die-face face-1">1</div>
                                    <div class="die-face face-2">2</div>
                                    <div class="die-face face-3">3</div>
                                    <div class="die-face face-4">4</div>
                                    <div class="die-face face-5">5</div>
                                    <div class="die-face face-6">6</div>
                                </div>
                            </div>
                            <div class="die-container" id="die2-container">
                                <div class="die" id="die2">
                                    <div class="die-face face-1">1</div>
                                    <div class="die-face face-2">2</div>
                                    <div class="die-face face-3">3</div>
                                    <div class="die-face face-4">4</div>
                                    <div class="die-face face-5">5</div>
                                    <div class="die-face face-6">6</div>
                                </div>
                            </div>
                        </div>
                        <div id="dice-sum">-</div>
                    </aside>
                </div>
            </section>

            <!-- Column 3: AI Players (Right - Grid Layout) -->
            <section id="ai-players-column">
                <div id="ai-player-1" class="ai-player-container">
                    <!-- AI Player 1: player info + character/resources -->
                </div>
                <div id="ai-player-2" class="ai-player-container">
                    <!-- AI Player 2: player info + character/resources -->
                </div>
            </section>
        </main>

        <!-- Game Log (Bottom, collapsible) - Starts collapsed on mobile -->
        <aside id="game-log-section" class="collapsed">
            <button id="toggle-log-btn" class="toggle-log-btn">‚ñ≤ Mostrar Registro</button>
            <div id="game-log" class="log-content collapsed">
                <h3>Registro</h3>
                <div id="log-messages"></div>
            </div>
        </aside>

        <!-- Modal for Character Selection -->
        <div id="character-modal" class="modal hidden">
            <div class="modal-content">
                <h2 class="character-selection-title">Selecciona tu Personaje</h2>
                <div id="character-options"></div>
            </div>
        </div>

        <!-- Modal for Guild Selection -->
        <div id="guild-modal" class="modal hidden">
            <div class="modal-content">
                <h2>Selecciona un Gremio</h2>
                <div id="guild-options"></div>
                <button class="btn-secondary" id="cancel-guild-btn">Cancelar</button>
            </div>
        </div>

        <!-- Difficulty Selection Modal -->
        <div id="difficulty-modal" class="modal">
            <div class="modal-content">
                <h2>Bienvenido a Gremios</h2>
                <p class="difficulty-instruction">Selecciona la dificultad de la IA</p>
                <div id="difficulty-options">
                    <button class="difficulty-option" data-difficulty="easy">
                        <h3>F√°cil</h3>
                        <p>IA con estrategia b√°sica y decisiones aleatorias</p>
                    </button>
                    <button class="difficulty-option" data-difficulty="medium">
                        <h3>Media</h3>
                        <p>IA con estrategia equilibrada que prioriza VP</p>
                    </button>
                    <button class="difficulty-option" data-difficulty="hard">
                        <h3>Dif√≠cil</h3>
                        <p>IA avanzada que maximiza VP y se adapta al estado del juego</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Over Modal -->
        <div id="game-over-modal" class="modal hidden">
            <div class="modal-content">
                <h2>¬°Partida Terminada!</h2>
                <div id="final-scores"></div>
                <button class="btn-primary" id="new-game-btn">Nueva Partida</button>
            </div>
        </div>

        <!-- Event Display Modal -->
        <div id="event-modal" class="modal hidden">
            <div class="modal-content event-modal-content">
                <div id="event-modal-card" class="event-card-large">
                    <div class="event-card-inner">
                        <div class="event-card-back"></div>
                        <div class="event-card-front"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Character Info Modal -->
        <div id="character-info-modal" class="modal hidden">
            <div class="modal-content character-info-modal-content">
                <h2 id="character-info-modal-title">Informaci√≥n del Personaje</h2>
                <div id="character-info-modal-body">
                    <!-- Character details will be populated here -->
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="help-modal" class="modal hidden">
            <div class="modal-content help-modal-content">
                <button class="close-help-btn" id="close-help-btn">‚úï</button>
                <h2>Ayuda - Gremios</h2>

                <div class="help-section">
                    <h3>‚å®Ô∏è Atajos de Teclado</h3>
                    <div class="hotkeys-grid">
                        <div class="hotkey-row">
                            <kbd>F</kbd>
                            <span>Alternar pantalla completa</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>Space</kbd>
                            <span>Terminar turno</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>A</kbd> o <kbd>H</kbd> o <kbd>?</kbd>
                            <span>Mostrar/Ocultar ayuda</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>I</kbd>
                            <span>Invertir en Gremio</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>E</kbd>
                            <span>Invertir en Expedici√≥n</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>L</kbd>
                            <span>Comprar Tierra</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>C</kbd>
                            <span>Cultivar Tierra</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>B</kbd>
                            <span>Construir Posada</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>R</kbd>
                            <span>Reparar Posada</span>
                        </div>
                        <div class="hotkey-row">
                            <kbd>ESC</kbd>
                            <span>Cerrar modal/Cancelar</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>‚ÑπÔ∏è Informaci√≥n del Juego</h3>
                    <div class="info-grid">
                        <div class="info-row">
                            <strong>Versi√≥n:</strong>
                            <span id="game-version">1.0.0</span>
                        </div>
                        <div class="info-row">
                            <strong>Tiempo de juego:</strong>
                            <span id="game-time">00:00</span>
                        </div>
                        <div class="info-row">
                            <strong>Turno actual:</strong>
                            <span id="current-turn">-</span>
                        </div>
                        <div class="info-row">
                            <strong>Cartas restantes:</strong>
                            <span id="cards-remaining">-</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üéØ Objetivo</h3>
                    <p>Ser el primer jugador en alcanzar 10 Puntos de Victoria (VP) invirtiendo en gremios, construyendo posadas, cultivando tierras y encontrando tesoros.</p>
                </div>

                <button class="btn-primary btn-modal-close" id="close-help-btn-bottom">Cerrar</button>
            </div>
        </div>

    </div>

    <!-- Landscape Prompt Modal -->
    <div id="landscape-prompt-modal" class="modal hidden">
        <div class="modal-content landscape-prompt-content">
            <h2>‚ö†Ô∏è Modo Horizontal Requerido</h2>
            <div class="landscape-icon-container">
                <div class="rotate-phone-icon">
                    <span class="phone-icon">üì±</span>
                    <span class="rotation-arrow">‚Üª</span>
                </div>
            </div>
            <p class="landscape-message"><strong>Este juego requiere orientaci√≥n horizontal.</strong><br>Por favor rota tu dispositivo para continuar.</p>
            <button class="btn-primary" id="enter-fullscreen-landscape-btn">Rotar y Continuar</button>
        </div>
    </div>

    <!-- Low Resolution Blocking Modal -->
    <div id="low-resolution-modal" class="modal hidden low-resolution-blocking">
        <div class="modal-content low-resolution-content">
            <h2>‚ö†Ô∏è Resoluci√≥n Insuficiente</h2>
            <div class="warning-icon">üì± ‚ùå</div>
            <p class="warning-message">La resoluci√≥n de tu pantalla es demasiado baja para jugar a Gremios.</p>
            <div class="suggestions">
                <h3>Por favor, intenta:</h3>
                <ul>
                    <li>üîÑ Rotar tu dispositivo a modo <strong>horizontal</strong></li>
                    <li>‚õ∂ Activar <strong>pantalla completa</strong></li>
                    <li>üíª Usar un dispositivo con mayor resoluci√≥n</li>
                    <li>üñ•Ô∏è Jugar en un ordenador o tablet</li>
                </ul>
            </div>
            <button class="btn-primary" id="try-fullscreen-low-res-btn">Intentar Pantalla Completa</button>
            <p class="min-resolution-note">Resoluci√≥n m√≠nima requerida: 480px √ó 270px (landscape)</p>
        </div>
    </div>

    <!-- iOS Add to Home Screen Instructions Modal -->
    <div id="ios-instructions-modal" class="modal hidden">
        <div class="modal-content ios-instructions-content">
            <h2>üì± Pantalla Completa en iPhone</h2>
            <p class="ios-intro">iOS no permite pantalla completa en Safari. Para la mejor experiencia, a√±ade Gremios a tu pantalla de inicio:</p>

            <div class="ios-steps">
                <div class="ios-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <p><strong>Toca el bot√≥n de compartir</strong></p>
                        <p class="step-icon">üì§</p>
                        <p class="step-detail">(En la barra inferior de Safari)</p>
                    </div>
                </div>

                <div class="ios-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <p><strong>Selecciona "A√±adir a pantalla de inicio"</strong></p>
                        <p class="step-icon">‚ûï</p>
                        <p class="step-detail">Despl√°zate hacia abajo si no lo ves</p>
                    </div>
                </div>

                <div class="ios-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <p><strong>Confirma y abre desde tu pantalla de inicio</strong></p>
                        <p class="step-icon">üè†</p>
                        <p class="step-detail">La app se abrir√° en pantalla completa</p>
                    </div>
                </div>
            </div>

            <div class="ios-benefits">
                <p><strong>Ventajas:</strong></p>
                <ul>
                    <li>‚úÖ Pantalla completa autom√°tica</li>
                    <li>‚úÖ Sin barras de navegaci√≥n</li>
                    <li>‚úÖ Funciona sin conexi√≥n</li>
                    <li>‚úÖ Acceso r√°pido desde inicio</li>
                </ul>
            </div>

            <button class="btn-primary" id="close-ios-instructions-btn">Entendido</button>
            <p class="ios-note">Tambi√©n puedes jugar en Safari, pero la pantalla completa no estar√° disponible.</p>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/cards.js"></script>
    <script src="js/characters.js"></script>
    <script src="js/player.js"></script>
    <script src="js/events.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
