/* ===========================
   CSS Variables - Responsive Design Foundation
   =========================== */

:root {
    /* Font Sizing - Consistent Typography Scale with better responsive behavior */
    --font-tiny: clamp(9px, 1.2vmin, 20px);      /* Log messages, fine print */
    --font-small: clamp(10px, 1.4vmin, 24px);    /* Resources, labels */
    --font-body: clamp(11px, 1.6vmin, 28px);     /* Player info, standard UI */
    --font-medium: clamp(7px, 2vw + 0.4vh, 40px);   /* Action buttons - responsive across all screens */
    --font-large: clamp(14px, 2.2vmin, 38px);    /* Character names, section titles */
    --font-xl: clamp(16px, 2.6vmin, 44px);       /* Modal headings */
    --font-xxl: clamp(18px, 3vmin, 50px);        /* Difficulty options, game titles */
    --font-dice: clamp(20px, 3.5vmin, 56px);     /* Dice numbers (special) */

    /* Legacy aliases for compatibility */
    --base-font-size: clamp(11px, 1.6vmin, 28px);
    --font-h1: clamp(18px, 3vmin, 50px);
    --font-h2: clamp(16px, 2.6vmin, 44px);
    --font-h3: clamp(14px, 2.2vmin, 38px);
    --font-h4: clamp(12px, 1.8vmin, 32px);

    /* Spacing - Fluid responsive spacing */
    --spacing-unit: clamp(2px, 0.4vmin, 8px);
    --spacing-xs: clamp(2px, 0.4vmin, 8px);
    --spacing-sm: clamp(4px, 0.6vmin, 12px);
    --spacing-md: clamp(6px, 0.8vmin, 15px);
    --spacing-lg: clamp(8px, 1vmin, 20px);
    --spacing-xl: clamp(10px, 1.2vmin, 30px);

    /* Component Dimensions */
    --player-zone-min-height: clamp(150px, 25vh, 400px);
    --guild-grid-min-height: clamp(200px, 40vh, 450px);
    --action-button-height: clamp(24px, 4vh, 48px);  /* Responsive sizing - shrinks to fit viewport */

    /* Board-relative sizing - scales with the board, not the viewport */
    --board-scale-factor: 1; /* Default scale factor */
    --coin-size-base: 4vmin; /* Base size for calculation */
    --coin-size: clamp(24px, var(--coin-size-base), 50px);
    --dice-size: clamp(36px, 7vmin, 90px);

    /* Border and UI elements */
    --border-radius-sm: clamp(4px, 0.5vmin, 6px);
    --border-radius-md: clamp(6px, 0.7vmin, 8px);
    --border-radius-lg: clamp(8px, 1vmin, 10px);
    --border-width: clamp(1px, 0.2vmin, 2px);

    /* Game board layout */
    --game-board-gap: clamp(3px, 0.8vmin, 15px);
    --body-padding: clamp(2px, 1vmin, 15px);

    /* Guild card dimensions on board (percentages of board) */
    --guild-card-width: 16.08%;
    --guild-card-height: 20.52%;

    /* Investment slot sizing */
    --investment-slot-size: clamp(12px, 2vmin, 26px);
    --guild-number-size: clamp(12px, 2.2vmin, 30px);

    /* Game log */
    --log-max-height: clamp(100px, 15vh, 200px);

    /* Modal sizing */
    --modal-padding: clamp(10px, 2vmin, 30px);
    --modal-max-width: clamp(400px, 60vw, 600px);

    /* ===========================
       Medieval Color Palette
       =========================== */

    /* Primary Colors - Improved Contrast Medieval Theme */
    --color-parchment: #f4e8d0;          /* Aged paper background */
    --color-dark-vellum: #1a1510;        /* Darker background for better contrast */
    --color-burgundy: #8b3545;           /* Brighter medieval wine red */
    --color-forest-moss: #5a7550;        /* Brighter forest green */
    --color-antique-gold: #e6c870;       /* Brighter gold for better visibility */
    --color-weathered-bronze: #8b5a3c;   /* Lighter bronze */
    --color-tarnished-silver: #a8abad;   /* Lighter silver */

    /* Accent Colors - Enhanced Visibility */
    --color-illuminated-blue: #4a7aa0;   /* Brighter blue for borders */
    --color-wax-seal-red: #b85555;       /* Lighter red */
    --color-monastery-stone: #6d6658;    /* Lighter stone */
    --color-aged-vellum: #f5eed9;        /* Lighter parchment */

    /* Status Colors - High Contrast */
    --color-success-green: #7aa64f;      /* Brighter green */
    --color-warning-amber: #e6a020;      /* Brighter amber */
    --color-danger-crimson: #c54545;     /* Brighter crimson */

    /* Text Colors - Improved Readability */
    --color-text-primary: #1a1510;       /* Darker text for better contrast */
    --color-text-light: #ffffff;         /* Pure white for dark backgrounds */
    --color-text-muted: #b8b0a0;         /* Lighter muted text */

    /* Semi-transparent overlays - Increased opacity */
    --color-overlay-dark: rgba(26, 21, 16, 0.95);    /* Darker overlay */
    --color-overlay-medium: rgba(26, 21, 16, 0.90);  /* Medium overlay */
    --color-overlay-light: rgba(26, 21, 16, 0.80);   /* Light overlay */
}

/* ===========================
   Responsive Font Adjustments
   Fine-tuning for specific screen sizes
   =========================== */

/* ===========================
   Responsive Font Adjustments - OPTIMIZED
   Consolidated from 24 to 6 essential breakpoints
   =========================== */

/* Near-Square Resolutions ONLY - Specific fix for aspect ratios 0.95-1.05 */
@media screen and (min-aspect-ratio: 19/20) and (max-aspect-ratio: 21/20) {
    /* NARROWED RANGE: Only truly near-square viewports (0.95 to 1.05) */
    /* Affects: 813x794 (1.024), 800x800 (1.0), similar square displays */
    /* Does NOT affect: 1366x768 (1.779), 1920x1080 (1.778), 1041x815 (1.277) */

    /* === BOARD LAYOUT === */
    #guilds-grid {
        /* REMOVED transform: scale() to fix percentage positioning alignment */
        /* CRITICAL FIX: Force container to match board image aspect ratio */
        /* Without this, container becomes too tall and cards misalign */
        width: 100% !important;
        height: auto !important;
        aspect-ratio: 1200 / 1311 !important;
        max-height: 92vh !important;
    }

    /* Grid columns: Give human column enough space for action buttons */
    /* 25% | 50% | 25% - at 813px this gives ~203px for human column */
    #game-board {
        grid-template-columns: 1fr 2fr 1fr !important;
        gap: clamp(1px, 0.2vmin, 3px);
    }

    /* Ensure guild cards stay within bounds */
    .guild-card {
        max-width: 16.08% !important;
        max-height: 20.52% !important;
    }

    /* === HUMAN COLUMN LAYOUT === */
    /* CRITICAL: NO scrolling - all content must fit in viewport */
    #human-column {
        overflow: hidden !important;
    }

    /* Adjust grid row allocation - prioritize actions section */
    body:not(.character-selection-phase) #human-column {
        /* Changed from auto/auto/1fr to give more guaranteed space to actions */
        grid-template-rows: auto minmax(0, 35%) minmax(300px, 1fr) !important;
    }

    /* Ensure player resources section is compact */
    .player-character-and-resources {
        overflow: visible !important;
        min-height: 0;
        flex-shrink: 1;
    }

    /* Ensure actions section gets enough space */
    .player-actions-section {
        min-height: 250px !important;
        flex-shrink: 0 !important;
    }

    /* === ACTION BUTTONS === */
    /* Reduce button size to fit in narrower column */
    .action-btn {
        font-size: clamp(9px, 1.6vmin, 14px) !important;
        padding: clamp(0.25em, 0.8vmin, 0.6em) !important;
        min-height: clamp(32px, 5vh, 48px) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .actions-grid {
        grid-template-columns: repeat(auto-fit, minmax(clamp(65px, 11vw, 110px), 1fr)) !important;
        gap: clamp(2px, 0.3vmin, 4px) !important;
    }

    #actions-section {
        gap: clamp(2px, 0.3vmin, 4px) !important;
        display: flex !important;
        flex-direction: column !important;
    }

    .player-actions-section {
        padding: clamp(4px, 0.6vmin, 8px) !important;
        overflow: visible !important;
        display: flex !important;
        flex-direction: column !important;
    }

    /* CRITICAL: Ensure End Turn button is always visible */
    #end-turn-btn,
    .btn-end-turn {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        min-height: 44px !important;
        font-size: clamp(12px, 2vmin, 18px) !important;
        margin-top: auto !important;
        flex-shrink: 0 !important;
    }

    /* Utility buttons row */
    #utility-section {
        display: flex !important;
        gap: clamp(2px, 0.3vmin, 4px) !important;
        margin-top: clamp(4px, 0.6vmin, 8px) !important;
    }

    .btn-utility {
        display: flex !important;
        visibility: visible !important;
        flex: 1 !important;
    }

    /* === TREASURE DISPLAY === */
    /* Ensure treasure breakdown is visible */
    .treasure-breakdown-row {
        min-height: 0 !important;
        overflow: visible !important;
        display: flex !important;
        flex-direction: column;
    }

    .treasure-breakdown-row:empty {
        display: none !important;
    }

    .treasure-breakdown-inline {
        font-size: clamp(9px, 1.5vmin, 14px) !important;
        gap: clamp(3px, 0.5vmin, 6px) !important;
        padding: clamp(2px, 0.4vmin, 5px) !important;
    }

    .resource-icon-small {
        width: clamp(14px, 2vmin, 24px) !important;
        height: clamp(14px, 2vmin, 24px) !important;
    }

    .resource-count-small {
        font-size: clamp(10px, 1.5vmin, 18px) !important;
    }

    /* === RESOURCE DISPLAY OPTIMIZATION === */
    .player-resources {
        gap: clamp(2px, 0.3vmin, 5px) !important;
        padding: clamp(4px, 0.6vmin, 8px) !important;
    }

    .resource-row {
        gap: clamp(3px, 0.4vmin, 5px) !important;
    }

    .resource-item {
        gap: clamp(2px, 0.3vmin, 4px) !important;
    }

    .resource-item img {
        width: clamp(18px, 2.5vmin, 28px) !important;
        height: clamp(18px, 2.5vmin, 28px) !important;
    }

    .resource-item span {
        font-size: clamp(11px, 1.8vmin, 20px) !important;
    }

    /* === PLAYER INFO OPTIMIZATION === */
    .player-name {
        font-size: clamp(11px, 1.9vmin, 20px) !important;
    }

    .coin-count,
    .vp-count {
        font-size: clamp(18px, 2.8vmin, 32px) !important;
    }

    .player-info img {
        width: clamp(20px, 3vmin, 36px) !important;
        height: clamp(20px, 3vmin, 36px) !important;
    }

    /* === AI PLAYERS COLUMN === */
    #ai-players-column {
        overflow-y: auto !important;
        overflow-x: hidden !important;
    }

    #ai-players-column .player-name {
        font-size: clamp(9px, 1.5vmin, 16px) !important;
    }

    #ai-players-column .coin-count,
    #ai-players-column .vp-count {
        font-size: clamp(14px, 2.2vmin, 24px) !important;
    }

    #ai-players-column .resource-item img {
        width: clamp(16px, 2.3vmin, 26px) !important;
        height: clamp(16px, 2.3vmin, 26px) !important;
    }

    #ai-players-column .resource-item span {
        font-size: clamp(10px, 1.6vmin, 18px) !important;
    }
}

/* Portrait Orientation - Further adjustments for true portrait mode */
@media screen and (orientation: portrait) and (min-width: 640px) {
    #guilds-grid {
        /* REMOVED transform: scale() to fix percentage positioning alignment */
        /* Natural sizing without transform */
        height: min(100%, calc(85vh * 1200 / 1311)) !important;
    }

    #game-board {
        grid-template-columns: 0.7fr 2.6fr 0.7fr !important;
    }
}

/* Mobile: <768px */
@media screen and (max-width: 767px) {
    :root {
        --base-font-size: clamp(11px, 1.4vmin, 24px);
        --spacing-unit: clamp(3px, 0.5vmin, 8px);
        --font-medium: clamp(12px, 1.6vmin, 16px);
    }

    /* Enhanced modal readability */
    .modal-content {
        max-width: 95%;
        padding: 20px 16px;
    }

    .modal-content h2 {
        font-size: clamp(18px, 4vmin, 28px) !important;
        margin-bottom: 16px;
    }

    .modal-content h3 {
        font-size: clamp(16px, 3.5vmin, 24px) !important;
        margin-bottom: 12px;
    }

    .modal-content p,
    .modal-content li {
        font-size: clamp(13px, 2.8vmin, 18px) !important;
        line-height: 1.5;
        margin-bottom: 10px;
    }

    .modal-content button {
        font-size: clamp(14px, 3vmin, 20px) !important;
        padding: 12px 20px !important;
        min-height: 48px;
    }

    /* Character selection improvements */
    .character-option {
        margin-bottom: 12px !important;
    }

    .character-name {
        font-size: clamp(10px, 1.7vmin, 20px) !important;
        margin-bottom: 8px !important;
        white-space: nowrap !important;
        line-height: 1.1;
        width: 100% !important;
        max-width: 100% !important;
        overflow: hidden !important;
    }

    /* Show character abilities during selection */
    #character-modal .character-abilities,
    #character-options .character-abilities,
    #character-options-inline .character-abilities,
    #character-selection-view .character-abilities,
    .character-selection-view .character-abilities,
    .character-option .character-abilities {
        display: block !important;
        visibility: visible !important;
        height: auto !important;
        overflow: visible !important;
        max-height: none !important;
    }

    /* Hide character abilities during gameplay - show only name */
    .player-info-view .character-abilities,
    .character-info .character-abilities,
    .player-character .character-abilities,
    #ai-player-1 .character-abilities,
    #ai-player-2 .character-abilities,
    #ai-players-column .character-abilities {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        overflow: hidden !important;
        max-height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    /* Hide paragraphs only in gameplay areas, not in selection */
    .player-info-view .character-abilities p,
    .character-info .character-abilities p,
    #ai-players-column .character-abilities p,
    .player-character .character-abilities > * {
        display: none !important;
        visibility: hidden !important;
    }

    /* Make character info clickable with clear visual indication */
    .character-info {
        cursor: pointer !important;
        transition: all 0.2s ease;
    }

    .character-info:hover {
        background: rgba(90, 115, 80, 0.5) !important;
        transform: translateY(-1px);
    }

    .character-info:active {
        transform: translateY(0);
    }

    .character-info .character-name {
        text-decoration: underline !important;
        text-decoration-style: dotted !important;
        text-decoration-color: var(--color-antique-gold) !important;
        position: relative;
    }

    .character-info .character-name:hover {
        color: #ffd700 !important;
    }

    /* Player panel improvements */
    .player-zone h3 {
        font-size: clamp(15px, 3.2vmin, 22px) !important;
        margin-bottom: 10px;
    }

    .player-info {
        font-size: clamp(12px, 2.8vmin, 17px) !important;
    }

    .player-coins,
    .player-vp {
        font-size: clamp(13px, 2.9vmin, 18px) !important;
    }

    /* Resource display improvements */
    .player-resources {
        font-size: clamp(12px, 2.8vmin, 17px) !important;
        gap: 6px !important;
        padding: 8px !important;
    }

    .resource-icon-large {
        width: 26px !important;
        height: 26px !important;
        min-width: 26px !important;
        min-height: 26px !important;
    }

    .resource-count {
        font-size: clamp(13px, 3vmin, 18px) !important;
        font-weight: 700 !important;
    }

    /* Color coding for resource counts */
    .resource-count-green {
        color: #4ade80 !important; /* Bright green for cultivated lands */
    }

    .resource-count-red {
        color: #f87171 !important; /* Bright red for destroyed inns */
    }

    .lands-count,
    .inns-count,
    .treasures-count,
    .cultivated-count,
    .destroyed-count {
        font-size: 1.2em !important;
    }

    /* Action button improvements */
    .action-btn {
        padding: 10px 6px !important;
        font-size: clamp(11px, 2.5vmin, 16px) !important;
        min-height: 48px;
        gap: 4px !important;
    }

    .action-text {
        font-size: 0.8em !important;
        font-weight: 700 !important;
    }

    /* Hide button text on small devices - keep only icons */
    .btn-text-large {
        display: none !important;
    }

    /* Make icons larger when text is hidden */
    .fullscreen-icon,
    .help-icon {
        font-size: 2em !important;
        font-weight: bold;
    }

    .btn-end-turn {
        font-size: clamp(15px, 3.2vmin, 22px) !important;
        padding: 14px 12px !important;
        min-height: 52px;
        font-weight: 700 !important;
    }

    /* Guild card improvements */
    .guild-card {
        font-size: clamp(11px, 2.5vmin, 15px) !important;
        padding: 6px !important;
    }

    .guild-card .guild-name {
        font-size: 1.1em !important;
        margin-bottom: 4px;
    }

    /* Game board spacing */
    #game-board {
        gap: 8px;
    }

    /* Player header spacing */
    .player-header {
        gap: 8px !important;
        padding: 8px !important;
    }

    /* Coin icons in UI */
    .coin-icon {
        width: 20px !important;
        height: 20px !important;
        min-width: 20px !important;
        min-height: 20px !important;
    }

    /* Fullscreen button */
    .fullscreen-btn {
        width: 50px !important;
        height: 50px !important;
        font-size: 26px !important;
    }

    /* Help and info text */
    .help-text,
    .info-text {
        font-size: clamp(13px, 2.8vmin, 18px) !important;
        line-height: 1.5;
    }

    /* Better spacing in action sections */
    .player-actions-section {
        padding: 10px !important;
    }

    .player-actions-section h4 {
        font-size: clamp(14px, 3vmin, 20px) !important;
        margin-bottom: 8px !important;
    }

    .actions-grid {
        gap: 8px !important;
    }

    /* Inline treasure breakdown - mobile responsive */
    .treasure-breakdown-inline {
        gap: clamp(4px, 0.9vmin, 9px);
        padding: clamp(2px, 0.5vmin, 5px);
        flex-wrap: wrap;
    }

    .resource-icon-small {
        width: clamp(18px, 2.5vmin, 32px);
        height: clamp(18px, 2.5vmin, 32px);
    }

    .resource-count-small {
        font-size: clamp(11px, 1.6vmin, 20px);
        min-width: clamp(16px, 2.2vmin, 26px);
    }

    .treasure-breakdown-item {
        gap: clamp(4px, 0.7vmin, 7px);
    }
}

/* Tablet: 768-1366px - Optimized for landscape mobile/tablet devices */
/* Exclude near-square resolutions (aspect ratio between 5:6 and 6:5) */
@media screen and (min-width: 768px) and (max-width: 1366px) and (min-aspect-ratio: 6/5) {
    :root {
        /* Enhanced font sizes for better readability */
        --font-tiny: clamp(10px, 1.5vmin, 22px);
        --font-small: clamp(12px, 1.8vmin, 26px);
        --font-body: clamp(13px, 2vmin, 30px);
        --font-medium: clamp(14px, 2.2vmin, 32px);
        --font-large: clamp(16px, 2.6vmin, 40px);

        /* Optimized spacing - slightly reduced to fit more content */
        --spacing-unit: clamp(1px, 0.3vmin, 5px);
        --action-button-height: clamp(36px, 6vh, 60px);
    }

    /* Adjust grid column ratios: give more space to board, slightly less to sides */
    #game-board {
        grid-template-columns: 0.85fr 2.3fr 0.85fr !important;  /* ~21% | 58% | 21% */
        gap: clamp(2px, 0.25vmin, 4px);
    }

    /* REMOVED transform: scale() to fix percentage positioning alignment */
    #guilds-grid {
        /* Natural sizing without transform */
    }

    /* Increase player name sizes */
    .player-name {
        font-size: clamp(12px, 2vmin, 22px) !important;
    }

    /* Increase character name sizes */
    .character-name {
        font-size: clamp(11px, 1.8vmin, 20px) !important;
    }

    /* Increase coin/VP display sizes */
    .coin-count,
    .vp-count {
        font-size: clamp(20px, 3vmin, 38px) !important;
    }

    /* Increase coin/VP icon sizes */
    .player-info img {
        width: clamp(24px, 3.5vmin, 44px) !important;
        height: clamp(24px, 3.5vmin, 44px) !important;
    }

    /* Increase resource icon sizes */
    #human-column .resource-item img {
        width: clamp(22px, 3.2vmin, 36px) !important;
        height: clamp(22px, 3.2vmin, 36px) !important;
    }

    /* Increase resource text sizes */
    .resource-item span {
        font-size: clamp(14px, 2.2vmin, 26px) !important;
    }

    /* Larger action buttons */
    .action-button {
        font-size: clamp(12px, 2.2vmin, 18px) !important;
        padding: clamp(0.5em, 1.5vmin, 1em) !important;
        min-height: 38px !important;
    }

    /* Increase button grid gaps */
    #actions-section {
        gap: clamp(3px, 0.5vmin, 6px) !important;
    }

    /* Reduce section gaps to fit content vertically */
    #human-column {
        gap: clamp(2px, 0.4vmin, 5px) !important;
    }

    /* Optimize player resources section spacing */
    .player-resources {
        gap: clamp(1px, 0.3vmin, 4px) !important;
    }

    .resource-row {
        gap: clamp(3px, 0.5vmin, 6px) !important;
    }

    /* Optimize AI player display */
    .ai-player-info {
        gap: clamp(2px, 0.4vmin, 5px) !important;
    }

    /* Increase AI player text for better visibility */
    #ai-players-column .player-name {
        font-size: clamp(10px, 1.6vmin, 18px) !important;
    }

    #ai-players-column .coin-count,
    #ai-players-column .vp-count {
        font-size: clamp(16px, 2.4vmin, 28px) !important;
    }

    #ai-players-column .resource-item img {
        width: clamp(18px, 2.6vmin, 30px) !important;
        height: clamp(18px, 2.6vmin, 30px) !important;
    }

    #ai-players-column .resource-item span {
        font-size: clamp(11px, 1.8vmin, 20px) !important;
    }
}

/* Desktop: 1367-1919px */
@media screen and (min-width: 1367px) and (max-width: 1919px) {
    :root {
        --base-font-size: clamp(9px, 1.2vmin, 22px);
        --spacing-unit: clamp(2px, 0.35vmin, 7px);
        --font-medium: clamp(10px, 1vw + 0.3vh, 28px);
    }
}

/* High-res: 1920-3839px (includes Full HD, 2K) - with resource pane adjustments */
@media screen and (min-width: 1920px) and (max-width: 3839px) {
    :root {
        --base-font-size: clamp(8px, 1vmin, 20px);
        --spacing-unit: clamp(2px, 0.3vmin, 6px);
        --font-medium: clamp(12px, 0.75vw + 0.25vh, 34px);
    }

    .player-resources {
        font-size: clamp(10px, 1.4vmin, 16px);
        gap: clamp(4px, 0.8vmin, 10px);
    }

    .resource-icon {
        font-size: 16px;
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
        max-width: 20px;
        max-height: 20px;
    }

    .lands-count, .inns-count, .treasures-count, .cultivated-count, .destroyed-count {
        font-size: 1.15em;
    }
}

/* Ultra high-res: 3840px+ (4K and above) - with resource pane adjustments */
@media screen and (min-width: 3840px) {
    :root {
        --base-font-size: clamp(7px, 0.9vmin, 18px);
        --spacing-unit: clamp(1px, 0.25vmin, 5px);
        --font-medium: clamp(16px, 0.5vw + 0.2vh, 40px);
    }

    .player-resources {
        font-size: clamp(10px, 1.4vmin, 16px);
        gap: clamp(4px, 0.8vmin, 10px);
    }

    .resource-icon {
        font-size: 24px;
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        max-width: 32px;
        max-height: 32px;
    }

    .lands-count, .inns-count, .treasures-count, .cultivated-count, .destroyed-count {
        font-size: 1.3em;
    }
}

/* Retina displays (high DPI) */
@media (min-resolution: 2dppx) {
    :root {
        --base-font-size: clamp(9px, 1.3vmin, 24px);
        --font-medium: clamp(7px, 1.8vw + 0.3vh, 36px);
    }

    .action-btn {
        font-size: 2.5em;
    }

    .btn-end-turn {
        font-size: 2.5em;
    }
}

/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--color-parchment) 0%, var(--color-aged-vellum) 100%);
    color: var(--color-text-light); /* Changed from dark to white text */
    height: 100%;
    width: 100%;
    padding: 0;
    margin: 0;
    font-size: var(--base-font-size);
    overflow: hidden; /* Prevent scrolling */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

html {
    overflow: hidden; /* Prevent scrolling on html element too */
    height: 100%;
    width: 100%;
}

/* Fullscreen Button */
.fullscreen-btn {
    position: fixed;
    top: 15px;
    right: 15px;
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, var(--color-forest-moss) 0%, var(--color-illuminated-blue) 100%);
    border: 2px solid var(--color-monastery-stone);
    border-radius: 8px;
    color: var(--color-text-light);
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    z-index: 1001;
}

.fullscreen-btn:hover {
    background: linear-gradient(135deg, #5a7550 0%, #3a5f7b 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}

.fullscreen-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.fullscreen-icon {
    line-height: 1;
}

/* Player Color Indicator - REMOVED */

/* Emblem Badge */
.emblem-badge {
    display: inline-block;
    animation: emblem-glow 2s ease-in-out infinite;
    filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.6));
}

@keyframes emblem-glow {
    0%, 100% {
        filter: drop-shadow(0 0 4px rgba(201, 169, 97, 0.6));
    }
    50% {
        filter: drop-shadow(0 0 8px rgba(201, 169, 97, 0.9));
    }
}

/* Treasure List Styles */
.treasures-list {
    background: rgba(0, 0, 0, 0.4);
    padding: 8px;
    border-radius: 6px;
    margin-top: 10px;
}

.treasures-list h5 {
    color: var(--color-antique-gold);
    font-size: 1.1em;
    margin-bottom: 8px;
}

.treasure-type-row {
    display: flex;
    align-items: center;
    margin: 5px 0;
    padding: 4px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.sell-treasure-btn {
    background: var(--color-forest-moss);
    color: var(--color-text-light);
    border: none;
    padding: 3px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.05em;
    transition: background 0.2s;
}

.sell-treasure-btn:hover {
    background: #5a7550;
}

.sell-treasure-btn:active {
    background: #3d4d33;
}

#game-container {
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    padding: 0;
    margin: 0;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

/* Main Game Board - 3 Column Layout with explicit ratio (1fr | 2fr | 1fr) */
#game-board {
    display: grid;
    /* 3-column layout with exact proportions: Human (25%) | Board (50%) | AI Players (25%) */
    grid-template-columns: 1fr 2fr 1fr;  /* Explicit ratio: 1/4 | 2/4 | 1/4 */
    gap: clamp(2px, 0.2vmin, 3px);
    flex: 1;
    overflow: hidden;
    min-height: 0;
    width: 100%;
}

/* Column 1: Human Player (Left) */
#human-column {
    grid-column: 1;
    grid-row: 1;
    gap: clamp(2px, 0.2vmin, 3px);
    min-width: 0;
    overflow: hidden; /* No scrolling - all buttons must be visible */
    height: 100%;
    max-height: 100vh;
}

/* Flexbox layout during character selection */
body.character-selection-phase #human-column {
    display: flex;
    flex-direction: column;
}

/* Grid layout after character selection - fit content without scrolling */
body:not(.character-selection-phase) #human-column {
    display: grid;
    grid-template-rows: minmax(0, 15vh) auto 1fr;  /* Header (max 15vh), resources (auto-fit content), actions (remaining space) */
    grid-template-columns: 1fr;
    overflow: hidden;  /* Prevent scrolling */
    height: 100%;  /* Fill parent height */
}

/* Grid item placement for human column */
body:not(.character-selection-phase) #human-column .player-header {
    grid-row: 1;
    max-height: 15vh;  /* Constrain header to prevent overflow */
    overflow: hidden;
}

body:not(.character-selection-phase) #human-column .player-character-and-resources {
    grid-row: 2;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

body:not(.character-selection-phase) #human-column .player-actions-section {
    grid-row: 3;
    display: flex;
    flex-direction: column;
    min-height: 250px;  /* Ensure enough space for action buttons */
    overflow: hidden;  /* NO scrolling - everything must fit in viewport */
    gap: clamp(1px, 0.3vh, 4px);  /* Shrink gaps to fit more buttons */
}

/* Column 2: Game Board (Center, 50% width - 2fr) */
#board-column {
    grid-column: 2;
    grid-row: 1;
    min-width: 0;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

/* Column 3: AI Players (Right, 25% width - 1fr) */
#ai-players-column {
    grid-column: 3;
    grid-row: 1;
    min-width: 0;
    height: 100%;
    max-height: 100vh;
}

/* During character selection - ensure no overflow clipping */
body.character-selection-phase #ai-players-column {
    overflow: visible;
}

/* After character selection - allow scrolling if needed */
body:not(.character-selection-phase) #ai-players-column {
    overflow-y: auto;
    overflow-x: hidden;
}

/* Grid layout - both during and after character selection */
#ai-players-column {
    display: grid;
    grid-template-columns: 1fr;
    gap: clamp(24px, 4vmin, 48px);
}

/* DURING character selection - equal height for full character images */
body.character-selection-phase #ai-players-column {
    grid-template-rows: 1fr 1fr;  /* Equal height */
}

/* AFTER character selection - auto height based on content */
body:not(.character-selection-phase) #ai-players-column {
    grid-template-rows: auto auto;
}

/* AI player container styling */
.ai-player-container {
    display: flex;
    flex-direction: column;
    gap: clamp(3px, 0.5vmin, 6px);
    width: 100%;
    min-height: 0;
}

/* DURING character selection - containers must fill grid cell height */
body.character-selection-phase .ai-player-container {
    height: 100%;
    display: flex;
    flex-direction: column;
}

/* AI player header (compact: player info + character name) */
.ai-player-header {
    background: rgba(90, 115, 80, 0.8);  /* Green/red-tinted background */
    border: 2px solid var(--color-illuminated-blue);
    border-radius: var(--border-radius-md);
    padding: clamp(2px, 0.5vmin, 6px) clamp(3px, 0.6vmin, 8px);
    display: flex;
    flex-direction: column;
    gap: clamp(2px, 0.3vmin, 4px);
    flex: 0 0 auto;  /* Don't grow, only take needed space */
}

/* DURING CHARACTER SELECTION: Hide compact character name to save space */
body.character-selection-phase .player-character-compact {
    display: none !important;
}

/* Compact character section inside header - shown AFTER selection */
body:not(.character-selection-phase) .player-character-compact {
    display: flex;
    flex-direction: column;
    margin-top: clamp(2px, 0.4vmin, 4px);
}

.player-character-compact .character-info {
    background: transparent !important;
    border: none !important;
    padding: clamp(2px, 0.4vmin, 4px) 0 !important;
    margin: 0 !important;
}

.player-character-compact .character-name {
    text-align: center;
    font-size: clamp(8px, 1.3vmin, 16px);
    margin: 0;
    padding: 0;
}

/* AI player info (character image during selection, resources after) */
.ai-player-info {
    background: rgba(244, 232, 208, 0.15);  /* Light parchment background */
    border: 2px solid var(--color-illuminated-blue);
    border-radius: var(--border-radius-md);
    padding: clamp(4px, 0.8vmin, 10px);
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}

/* ========== DURING CHARACTER SELECTION ========== */
body.character-selection-phase .ai-player-info {
    /* Fill all remaining vertical space in container */
    flex: 1;
    display: flex !important;
    flex-direction: column;
    overflow: visible;
}

/* Hide resources, show character */
body.character-selection-phase .ai-player-info .player-resources {
    display: none !important;
}

body.character-selection-phase .ai-player-info .player-character {
    display: flex !important;
    flex: 1 !important;
    flex-direction: column !important;
    min-height: 0 !important;
    max-height: none !important;
    height: 100% !important;
}

body.character-selection-phase .ai-player-info .player-character .character-info {
    display: flex !important;
    flex: 1 !important;
    flex-direction: column !important;
    min-height: 0 !important;
    max-height: none !important;
    height: 100% !important;
    overflow: visible !important;
}

body.character-selection-phase .ai-player-info .character-image-container {
    display: flex !important;
    flex: 1;
    min-height: 0;
    height: auto;  /* Override global height: 80% to allow flexbox sizing */
    width: 100%;
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
}

body.character-selection-phase .ai-player-info .character-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    display: block;
}

/* ========== AFTER CHARACTER SELECTION ========== */
body:not(.character-selection-phase) .ai-player-info {
    flex: 0 0 auto;
    overflow-y: auto;
}

body:not(.character-selection-phase) .ai-player-info .player-character {
    display: none !important;
}

body:not(.character-selection-phase) .ai-player-info .player-resources {
    display: flex !important;
    flex-direction: column !important;
}

/* Resources container styling */
.ai-player-info .player-resources:not(.ai-resources-grid) {
    display: flex;
    flex-direction: column;
    background: transparent;
    border: none;
    padding: clamp(2px, 0.4vmin, 4px);
}

/* AI player resource icons - standardized with human player */
.ai-player-info .resource-icon-large {
    width: clamp(18px, 2.5vmin, 32px);
    height: clamp(18px, 2.5vmin, 32px);
}

/* AI player resource counts - standardized with human player */
.ai-player-info .resource-count {
    font-size: clamp(12px, 1.8vmin, 24px);
    min-width: clamp(16px, 2.2vmin, 30px);
}

/* Ensure AI character info auto-sizes to content */
body:not(.character-selection-phase) #ai-players-column .character-info {
    max-height: none !important;
    height: auto !important;
}

/* Active player highlighting for AI containers */
.ai-player-container.active-player .ai-player-header,
.ai-player-container.active-player .ai-player-info {
    border-color: var(--color-antique-gold);
    box-shadow: 0 0 15px rgba(201, 169, 97, 0.4);
}

/* Character and resources container */
.player-character-and-resources {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}


/* Event Cards on Board */
.event-card-on-board {
    position: absolute;
    width: var(--guild-card-width); /* Match guild card dimensions: 16.08% */
    height: var(--guild-card-height); /* Match guild card dimensions: 20.52% */
    background: url('../resources/other/Event_Back.png'); /* Default background for event deck */
    background-size: contain; /* Changed from cover to show full card image */
    background-position: center;
    background-repeat: no-repeat;
    border: none;
    border-radius: 6px;
    padding: 0; /* Remove padding to show full image */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 1;
    color: white;
    overflow: hidden; /* Prevent rendering artifacts */
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform: translateZ(0);
    transition: opacity 0.3s ease-in-out; /* Smooth fade in/out when deck becomes empty */
}

/* Background images for event cards - Blocking Events (combined with .blocking-event-card) */
.event-card-on-board[data-event-id="plague"],
.blocking-event-card[data-event-id="plague"] {
    background-image: url('../resources/blocking_events/Plague.png');
}

.event-card-on-board[data-event-id="famine"],
.blocking-event-card[data-event-id="famine"] {
    background-image: url('../resources/blocking_events/Famine.png');
}

.event-card-on-board[data-event-id="trade_blockade"],
.blocking-event-card[data-event-id="trade_blockade"] {
    background-image: url('../resources/blocking_events/TradeBlock.png');
}

.event-card-on-board[data-event-id="mine_collapse"],
.blocking-event-card[data-event-id="mine_collapse"] {
    background-image: url('../resources/blocking_events/MineCollapse.png');
}

.event-card-on-board[data-event-id="material_shortage"],
.blocking-event-card[data-event-id="material_shortage"] {
    background-image: url('../resources/blocking_events/ResourcesOutage.png');
}

/* Background images for event cards - Action Events */
.event-card-on-board[data-event-id="good_harvest"] {
    background-image: url('../resources/action_events/good_harvest.png');
}

.event-card-on-board[data-event-id="prosperity"] {
    background-image: url('../resources/action_events/prosperity.png');
}

.event-card-on-board[data-event-id="expedition"] {
    background-image: url('../resources/action_events/expedition.png');
}

.event-card-on-board[data-event-id="bad_harvest"] {
    background-image: url('../resources/action_events/bad_harvest.png');
}

.event-card-on-board[data-event-id="bankruptcy"] {
    background-image: url('../resources/action_events/bankruptcy.png');
}

.event-card-on-board[data-event-id="mutiny"] {
    background-image: url('../resources/action_events/mutiny.png');
}

.event-card-on-board[data-event-id="invasion"] {
    background-image: url('../resources/action_events/invasion.png');
}

.event-card-on-board[data-event-id="expropriation"] {
    background-image: url('../resources/action_events/expropriation.png');
}

.event-card-on-board[data-event-id="tax_collection"] {
    background-image: url('../resources/action_events/tax_collection.png');
}

/* Current Event Card - positioned at 244,29 pixels */
#current-event-card {
    left: 20.33%;
    top: 2.21%;
}

/* Previous Event Card - positioned at 503,29 pixels, black & white style */
#previous-event-card {
    left: 41.92%;
    top: 2.21%;
}

.event-card-on-board.previous-event {
    border-color: #666;
}

.event-card-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

/* Hide all content inside event cards (names, descriptions, deck counts) */
.event-card-content > * {
    display: none;
}

.event-card-on-board .event-name {
    font-weight: bold;
    font-size: 0.9em;
    color: white;
    display: none; /* Hide event name */
}

.event-card-on-board .event-deck-count {
    font-size: 0.85em;
    color: var(--color-antique-gold);
    font-weight: bold;
    display: none; /* Hide event deck count */
}

#temp-events-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.temp-event {
    background: rgba(122, 46, 46, 0.3);
    border: 1px solid var(--color-danger-crimson);
    border-radius: 5px;
    padding: 8px;
    font-size: 0.9em;
}

/* Guilds Area */
#board-column {
    background: rgba(45, 79, 107, 0.6);
    padding: var(--spacing-md);
    border-radius: var(--border-radius-lg);
    border: 2px solid var(--color-illuminated-blue);
    display: flex;
    align-items: center;
    justify-content: center;
}

#guilds-grid {
    position: relative;
    /* Let aspect-ratio control dimensions - use width-based sizing */
    width: min(100%, calc(94vh * 1200 / 1311));
    height: auto; /* Let aspect-ratio calculate height */
    max-width: 100%;
    max-height: 94vh;
    aspect-ratio: 1200 / 1311; /* Maintain board proportions */
    background-image: url('../resources/Board.png');
    background-size: contain; /* Preserve image proportions without stretching */
    background-repeat: no-repeat;
    background-position: center;
    margin: 0 auto; /* Center horizontally */
    /* Scale to fit container while maintaining aspect ratio */
    object-fit: contain;
    /* REMOVED transform: scale() to fix percentage positioning alignment */
}

/* Guild positioning on board - base properties are defined below */

/* Top row guilds - exact coordinates from user (193x269px at specified positions) */
.guild-card[data-guild-number="2"] {
    left: 2.50%;  top: 27.23%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Church.png');
}
.guild-card[data-guild-number="3"] {
    left: 22.17%; top: 27.23%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Blacksmith.png');
}
.guild-card[data-guild-number="4"] {
    left: 41.83%; top: 27.23%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Quarry.png');
}
.guild-card[data-guild-number="5"] {
    left: 61.67%; top: 27.23%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Port.png');
}
.guild-card[data-guild-number="6"] {
    left: 81.42%; top: 27.23%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Farm.png');
}

/* Bottom row guilds - exact coordinates from user (193x269px at specified positions) */
.guild-card[data-guild-number="12"] {
    left: 2.50%;  top: 77.27%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Monastery.png');
}
.guild-card[data-guild-number="11"] {
    left: 22.17%; top: 77.27%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Jewelers.png');
}
.guild-card[data-guild-number="10"] {
    left: 41.83%; top: 77.27%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Sawmill.png');
}
.guild-card[data-guild-number="9"] {
    left: 61.67%; top: 77.27%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Market.png');
}
.guild-card[data-guild-number="8"] {
    left: 81.42%; top: 77.27%; width: 16.08%; height: 20.52%;
    background-image: url('../resources/guilds/Tavern.png');
}

.blocking-event-row {
    position: absolute;
    top: 52.25%;
    width: 16.08%;
    height: 20.52%;
}

/* Position blocking event columns - aligned with guild columns at Y=685 (52.25%) */
.blocking-event-row[style*="grid-column: 1"] { left: 2.50%; }
.blocking-event-row[style*="grid-column: 2"] { left: 22.17%; }
.blocking-event-row[style*="grid-column: 3"] { left: 41.83%; }
.blocking-event-row[style*="grid-column: 4"] { left: 61.67%; }
.blocking-event-row[style*="grid-column: 5"] { left: 81.42%; }

.blocking-event-card {
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border: none;
    border-radius: 6px;
    padding: 8px;
    color: white;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s, box-shadow 0.2s;
    z-index: 1;
    overflow: hidden; /* Prevent rendering artifacts */
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform: translateZ(0);
}

.blocking-event-card.stacked-event {
    /* When multiple events stack, offset them slightly */
}

.blocking-event-card.stacked-event:hover {
    transform: translateY(-5px) translateZ(0);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    z-index: 10;
}

.blocking-event-card .event-name {
    font-weight: bold;
    color: white;
    font-size: 0.9em;
    display: none; /* Hide event name */
}

.blocking-event-card .event-count {
    font-size: 0.85em;
    color: var(--color-antique-gold);
    font-weight: bold;
    margin-top: 8px;
    display: none; /* Hide event count */
}

.guild-card {
    position: absolute;
    background-size: contain; /* Show full card image without cropping */
    background-position: center;
    background-repeat: no-repeat;
    border: none; /* Remove border to show card properly and align investment slots */
    border-radius: 6px;
    padding: 0; /* Remove padding so background image matches container size exactly */
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s, box-shadow 0.3s;
    z-index: 1;
    overflow: hidden; /* Prevent rendering artifacts on edges */
    backface-visibility: hidden; /* Prevent flickering and black lines */
    -webkit-backface-visibility: hidden;
    transform: translateZ(0); /* Force GPU acceleration */
    will-change: transform; /* Optimize transform animations */
}

.guild-card:hover {
    transform: translateY(-5px) translateZ(0);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}

.guild-card.blocked {
    /* Indicate blocked state with red glow instead of border */
    box-shadow: 0 0 15px rgba(122, 46, 46, 0.6), 0 4px 8px rgba(0, 0, 0, 0.3);
}

.guild-card.blocked:hover {
    box-shadow: 0 0 20px rgba(122, 46, 46, 0.8), 0 6px 12px rgba(0, 0, 0, 0.4);
    transform: translateY(-5px) translateZ(0);
}

.guild-card.drag-over {
    /* Gold glow for drag target */
    box-shadow: 0 0 20px rgba(201, 169, 97, 0.7), 0 4px 8px rgba(0, 0, 0, 0.3);
    transform: scale(1.05) translateZ(0);
}

/* Tap highlight for double-tap feedback */
.guild-card.tap-highlight,
#expedition-card.tap-highlight {
    box-shadow: 0 0 15px rgba(201, 169, 97, 0.9), 0 4px 8px rgba(0, 0, 0, 0.4);
    transform: scale(1.03) translateZ(0);
    border: 2px solid var(--color-antique-gold);
    transition: all 0.15s ease-out;
}

.guild-number {
    position: absolute;
    top: var(--spacing-xs);
    right: var(--spacing-xs);
    background: var(--color-illuminated-blue);
    color: var(--color-antique-gold);
    width: var(--guild-number-size);
    height: var(--guild-number-size);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1em;
}

.guild-name {
    font-size: 1.1em;
    font-weight: bold;
    margin-bottom: 8px;
    color: var(--color-antique-gold);
}

.max-investor {
    position: absolute;
    top: 2%;
    left: 2%;
    width: 30.04%; /* Match investment slot size (percentage of card) */
    height: 21.53%; /* Match investment slot size */
    border-radius: 50%;
    border: none;
}

.investment-slots {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Allow clicks to pass through the container */
}

.investment-slot {
    position: absolute;
    /* Size based on image dimensions: 225/749 = 30.04% width, 225/1045 = 21.53% height */
    width: 30.04%;
    height: 21.53%;
    border-radius: 50%;
    border: var(--border-width) dashed var(--color-illuminated-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-tiny); /* Consistent investment slot text */
    font-weight: bold;
    pointer-events: auto; /* Re-enable clicks on the slots themselves */
    box-sizing: border-box;
}

/* Position each slot to match image placeholders (749x1045 image) */
/* Top left: (124, 450) */
.investment-slot:nth-child(1) {
    left: 16.55%;
    top: 43.06%;
}

/* Top right: (402, 450) */
.investment-slot:nth-child(2) {
    left: 53.67%;
    top: 43.06%;
}

/* Bottom left: (124, 697) */
.investment-slot:nth-child(3) {
    left: 16.55%;
    top: 66.70%;
}

/* Bottom right: (402, 697) */
.investment-slot:nth-child(4) {
    left: 53.67%;
    top: 66.70%;
}

.investment-slot.filled {
    border-style: solid;
    font-weight: bold;
    background: rgba(201, 169, 97, 0.15); /* Subtle gold background when filled */
}

/* Expedition Card - positioned on board like guild cards */
#expedition-card {
    position: absolute;
    left: 63.58%;
    top: 2.21%;
    width: var(--guild-card-width); /* Match guild card dimensions: 16.08% */
    height: var(--guild-card-height); /* Match guild card dimensions: 20.52% */
    background-image: url('../resources/guilds/Expedition.png');
    background-size: contain; /* Changed from cover to show full card image */
    background-position: center;
    background-repeat: no-repeat;
    border: none; /* Remove border to show card properly */
    border-radius: 6px;
    padding: 0; /* Remove padding to show full image */
    display: flex;
    flex-direction: column;
    transition: transform 0.2s;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 1;
}

#expedition-card:hover {
    transform: translateY(-5px);
}

/* Expedition card uses the same investment slot positioning as guild cards */

#expedition-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}

#expedition-card.drag-over {
    /* Gold glow for drag target */
    box-shadow: 0 0 20px rgba(201, 169, 97, 0.7), 0 4px 8px rgba(0, 0, 0, 0.3);
    transform: scale(1.05);
}

/* Players Area */
#ai-players-column {
    background: rgba(26, 21, 16, 0.85);
    padding: var(--spacing-sm);
    border-radius: var(--border-radius-md);
    border: 2px solid var(--color-illuminated-blue);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg); /* Larger spacing between opponent panes */
}

#ai-players-column .player-zone {
    margin-bottom: var(--spacing-sm); /* Additional spacing between AI player panes */
}

#human-column {
    background: rgba(26, 21, 16, 0.85);
    padding: var(--spacing-sm);
    border-radius: var(--border-radius-md);
    border: 2px solid var(--color-illuminated-blue);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.player-zone {
    background: rgba(45, 79, 107, 0.7);
    border: 2px solid var(--color-illuminated-blue);
    border-radius: var(--border-radius-md);
    padding: var(--spacing-sm);
    overflow: hidden; /* Changed from auto to hidden - no scrolling */
    min-height: 0;
    min-width: 0;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
}

/* Player info zone - fills available height */
#player-human {
    flex: 1; /* Grow to fill available height */
    overflow-y: auto;
    height: 100vh;
}

.player-zone.active-player {
    border-color: var(--color-antique-gold);
    box-shadow: 0 0 15px rgba(201, 169, 97, 0.4);
}

/* AI Player Compact Display Optimizations */
.player-zone.ai-player {
    padding: var(--spacing-xs);
    font-size: clamp(8px, 1.2vmin, 18px);
}

#ai-players-column .player-zone {
    padding: clamp(3px, 0.5vmin, 8px);
}

#ai-players-column .player-header {
    gap: var(--spacing-xs);
    flex-wrap: wrap;
    font-size: clamp(9px, 1.3vmin, 20px);
    align-items: baseline;  /* Use baseline for proper text alignment */
}

/* AI player section height constraints - normal gameplay */
#ai-player-1 .player-header,
#ai-player-2 .player-header {
    height: 5vh;
    max-height: 5vh;
    flex: 0 0 5vh;
    box-sizing: border-box;
}

#ai-player-1 .player-character,
#ai-player-2 .player-character {
    height: auto;
    max-height: none;
    flex: 0 0 auto;
    box-sizing: border-box;
}

#ai-player-1 .player-resources,
#ai-player-2 .player-resources {
    height: auto;
    max-height: 35vh;
    flex: 1 1 auto;
    box-sizing: border-box;
    overflow-y: auto;
}

/* AI resources grid - 3 columns, 2 rows */
#ai-player-1 .ai-resources-grid,
#ai-player-2 .ai-resources-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    grid-template-rows: auto auto !important;
    gap: clamp(4px, 0.8vmin, 8px) !important;
    padding: clamp(4px, 0.8vmin, 8px) !important;
    align-items: center;
    justify-items: center;
}

.ai-resources-grid .resource-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: clamp(2px, 0.4vmin, 4px);
    width: 100%;
}

/* Wide items in row 2 span 1.5 columns for better spacing */
.ai-resources-grid .resource-item-wide {
    grid-column: span 1;
}

/* Center the second row items by starting from column 1 */
.ai-resources-grid .resource-item:nth-child(4) {
    grid-column: 1;
}

.ai-resources-grid .resource-item:nth-child(5) {
    grid-column: 2;
}

#ai-players-column .player-name {
    font-size: clamp(10px, 1.7vmin, 20px);
    flex: 1 0 100%;
    margin-bottom: var(--spacing-xs);
    white-space: nowrap;
    line-height: 1.1;
    max-width: 100%;
    overflow: hidden;
}

#ai-players-column .player-coins,
#ai-players-column .player-vp {
    font-size: clamp(9px, 1.3vmin, 18px);
    font-weight: 700;
}

#ai-players-column .player-resources {
    gap: var(--spacing-xs);
    padding: var(--spacing-xs);
}

#ai-players-column .resource-row {
    gap: clamp(2px, 0.3vmin, 4px);
    justify-content: space-around;
}

#ai-players-column .resource-icon-large {
    width: clamp(12px, 1.8vmin, 24px);
    height: clamp(12px, 1.8vmin, 24px);
    min-width: clamp(12px, 1.8vmin, 24px);
    min-height: clamp(12px, 1.8vmin, 24px);
}

#ai-players-column .resource-count {
    font-size: clamp(8px, 1.2vmin, 16px);
    font-weight: 700;
}

#ai-players-column .character-info {
    padding: 0 !important;  /* NO padding */
    font-size: clamp(8px, 1.2vmin, 16px);
    margin: 0 !important;  /* NO margin */
    height: auto;
    border: none !important;  /* NO border */
}

#ai-players-column .character-name {
    font-size: clamp(9px, 1.4vmin, 16px);
    margin: 0 !important;  /* NO margin at all */
    white-space: nowrap;
    line-height: 1.1;
    width: 100%;
    max-width: 100%;
    overflow: hidden;
}

/* Remove margin from player-character in AI sections */
#ai-players-column .player-character {
    margin: 0 !important;  /* NO margin */
    padding: 0 !important;  /* NO padding */
}

/* Remove character image margin in AI sections */
#ai-players-column .character-image-container {
    margin-top: 0;  /* No margin above character image */
    margin-bottom: 0;
}

/* Reduce resources spacing in AI sections */
#ai-players-column .player-resources:not(.ai-resources-grid) {
    display: flex !important;
    flex-direction: column !important;
    gap: clamp(4px, 0.8vmin, 8px) !important;  /* Small gap between resource rows */
    padding: 2px 4px;  /* Minimal padding */
    margin: 0 !important;  /* NO margin */
}

.player-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;  /* Use baseline instead of center for text alignment */
    margin-bottom: var(--spacing-md);
    padding-bottom: var(--spacing-sm);
    border-bottom: 1px solid var(--color-illuminated-blue);
    flex: 0 0 auto;
}

/* Override .player-header spacing for AI players */
.ai-player-header {
    margin-bottom: 0;  /* No margin for seamless connection with info section */
    padding-bottom: 0;  /* No padding for seamless connection with info section */
}

/* Remove spacing from .player-header inside AI player headers */
.ai-player-header .player-header {
    margin-bottom: 0 !important;  /* No margin in AI headers */
    padding-bottom: 0 !important;  /* No padding in AI headers */
    padding: 0 !important;  /* No padding at all */
    border-bottom: none !important;  /* No border needed */
    gap: 0 !important;  /* No gap between flex items */
    min-height: 0;  /* Allow it to shrink */
    height: auto;  /* Auto height */
}

/* Remove margin from player name in AI headers */
#ai-players-column .ai-player-header .player-name {
    margin-bottom: 0 !important;  /* No margin below name */
    margin: 0 !important;  /* No margin at all */
}

.player-name {
    color: var(--color-antique-gold);
    font-size: clamp(10px, 1.7vmin, 20px); /* Standardized across all players */
    margin: 0;  /* Reset h3 default margin */
    line-height: 1.1;
    display: flex;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
    max-width: 100%;
    overflow: hidden;
    flex-shrink: 1;
}

.player-coins, .player-vp {
    font-size: var(--font-body); /* Consistent with player info */
    font-weight: bold;
    line-height: 1;  /* Consistent line height */
    display: flex;
    align-items: center;
    gap: 4px;
}

.coin-count {
    color: var(--color-antique-gold);
    font-size: clamp(18px, 2.5vmin, 36px);
    font-weight: bold;
}

.coin-icon {
    font-size: clamp(20px, 2.8vmin, 40px);
    display: inline-block;
    vertical-align: middle;
}

/* Coin icon images for AI players */
.coin-icon.coin-image {
    width: clamp(20px, 2.8vmin, 40px);
    height: clamp(20px, 2.8vmin, 40px);
    transition: transform 0.2s ease, opacity 0.2s ease;
}

/* Draggable coin states */
.coin-icon.coin-image[draggable="true"] {
    cursor: grab !important;
}

.coin-icon.coin-image[draggable="true"]:hover {
    transform: scale(1.1);
}

.coin-icon.coin-image.dragging {
    cursor: grabbing !important;
    opacity: 0.5;
    transform: scale(1.2);
}

/* Resource Icons - Images for lands, inns, treasures */
.resource-icon {
    width: 1.5em;
    height: 1.5em;
    display: inline-block;
    vertical-align: middle;
    margin: 0 2px;
    object-fit: contain;
}

/* Large Resource Icons for 3-row layout */
.resource-icon-large {
    width: clamp(40px, 5vmin, 80px);
    height: clamp(40px, 5vmin, 80px);
    display: inline-block;
    vertical-align: middle;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

/* Human player resource icons - standardized with AI player */
#player-info-view .resource-icon-large {
    width: clamp(18px, 2.5vmin, 32px);
    height: clamp(18px, 2.5vmin, 32px);
}

/* Resource Row Layout */
.resource-row {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: clamp(15px, 2vmin, 30px);
    margin: clamp(6px, 1vmin, 12px) 0;
    flex-wrap: wrap;
}

/* Human player resource rows - more compact */
#player-info-view .resource-row {
    gap: clamp(8px, 1.5vmin, 15px);
    margin: clamp(3px, 0.6vmin, 6px) 0;
}

.resource-item {
    display: flex;
    align-items: center;
    gap: clamp(6px, 1vmin, 12px);
}

/* Human player resource items - more compact */
#player-info-view .resource-item {
    gap: clamp(4px, 0.8vmin, 8px);
}

.resource-count {
    font-size: clamp(18px, 2.5vmin, 48px);
    font-weight: bold;
    color: var(--color-antique-gold);
    min-width: clamp(24px, 3vmin, 50px);
    text-align: left;
}

/* Human player resource counts - standardized with AI player */
#player-info-view .resource-count {
    font-size: clamp(12px, 1.8vmin, 24px);
    min-width: clamp(16px, 2.2vmin, 30px);
}

/* Ultra-wide screens: Add decorative side bars (>1492px, which is 2x reference 746px) */
@media screen and (min-width: 1492px) {
    body {
        background: linear-gradient(90deg,
            rgba(26, 21, 16, 0.95) 0%,
            rgba(45, 79, 107, 0.3) 15%,
            transparent 20%,
            transparent 80%,
            rgba(45, 79, 107, 0.3) 85%,
            rgba(26, 21, 16, 0.95) 100%);
    }

    #game-container {
        max-width: 1920px;  /* Limit game width to prevent excessive stretching */
        margin: 0 auto;  /* Center the game */
    }
}

/* Larger font for high-resolution screens */
@media (min-resolution: 2dppx) {
    .resource-count {
        font-size: clamp(28px, 3.5vmin, 72px);
    }
}

@media (min-width: 1920px) {
    .resource-count {
        font-size: clamp(32px, 4vmin, 80px);
    }
}

/* Ultra-high resolution screens (4K+) */
@media (min-width: 2560px) {
    .resource-count {
        font-size: clamp(40px, 4.5vmin, 96px);
    }
}

/* Treasure breakdown container */
.player-treasures-detail {
    margin-top: clamp(8px, 1.5vmin, 16px);
}

/* Human player treasure details - more compact */
#player-info-view .player-treasures-detail {
    margin-top: clamp(3px, 0.6vmin, 6px);
}

.treasure-breakdown {
    display: flex;
    align-items: center;
    gap: clamp(12px, 2vmin, 24px);
    flex-wrap: wrap;
    padding: clamp(6px, 1vmin, 12px);
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--border-radius-md);
}

/* Human player treasure breakdown - more compact */
#player-info-view .treasure-breakdown {
    gap: clamp(6px, 1.2vmin, 12px);
    padding: clamp(3px, 0.6vmin, 6px);
}

/* Smaller treasure breakdown icons for human player */
#player-info-view .treasure-breakdown .resource-icon-large {
    width: clamp(20px, 3vmin, 36px);
    height: clamp(20px, 3vmin, 36px);
}

#player-info-view .treasure-breakdown .resource-count {
    font-size: clamp(12px, 1.8vmin, 22px);
    min-width: clamp(16px, 2vmin, 28px);
}

/* Inline treasure breakdown for Row 3 */
/* Treasure breakdown row - ensure it's visible when content exists */
.treasure-breakdown-row {
    min-height: 0;
    margin: clamp(3px, 0.6vmin, 6px) 0;
}

.treasure-breakdown-row:empty {
    display: none;
}

.treasure-breakdown-inline {
    display: flex;
    align-items: center;
    gap: clamp(4px, 0.8vmin, 8px);
    flex-wrap: wrap;
    padding: clamp(3px, 0.6vmin, 6px);
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--border-radius-sm);
    width: 100%;
}

/* Treasure breakdown item spacing */
.treasure-breakdown-item {
    gap: clamp(3px, 0.6vmin, 6px);
}

/* Small resource icons for treasure breakdown */
.resource-icon-small {
    width: clamp(16px, 2.2vmin, 28px);
    height: clamp(16px, 2.2vmin, 28px);
    display: inline-block;
    vertical-align: middle;
    object-fit: contain;
    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.3));
}

/* Small resource counts for treasure breakdown */
.resource-count-small {
    font-size: clamp(10px, 1.4vmin, 18px);
    font-weight: bold;
    color: var(--color-antique-gold);
    min-width: clamp(14px, 2vmin, 24px);
    text-align: left;
}

/* Player treasures detail container in Row 3 */
.player-treasures-detail {
    display: inline-flex;
    align-items: center;
}

/* Old treasure-details-row kept for backward compatibility (now unused) */
.treasure-details-row {
    display: none;
}

/* Treasure item with sell button - responsive layout */
.treasure-item-with-sell {
    display: flex;
    align-items: center;
    gap: clamp(3px, 0.6vmin, 5px);
}

.treasure-item-with-sell .sell-treasure-btn {
    margin-left: clamp(2px, 0.4vmin, 5px);
}

/* At very low resolutions, make gap minimal */
@media (max-height: 400px) {
    .treasure-item-with-sell {
        gap: 2px !important;
    }

    .treasure-item-with-sell .sell-treasure-btn {
        margin-left: 2px !important;
    }
}

/* Discoverer emblem styling */
.discoverer-emblem {
    filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
}

.vp-count {
    color: #ffffff; /* White text for VP */
    font-size: clamp(18px, 2.5vmin, 36px);
    font-weight: bold;
}

.player-vp {
    font-size: clamp(16px, 2.2vmin, 32px);
}

/* Draggable Coins */
.draggable-coin {
    display: inline-flex;
    width: var(--coin-size);
    height: var(--coin-size);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border: none;
    cursor: grab;
    margin: 0; /* Remove margin - grid gap handles spacing */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s;
    font-size: var(--font-tiny); /* Scale font with coin size */
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #ffffff; /* Changed from black to white */
    flex-shrink: 0;
    box-sizing: border-box;
}

/* Coin types based on player colors */
.draggable-coin.gold {
    background-image: url('../resources/other/gold.png');
}

.draggable-coin.bronze {
    background-image: url('../resources/other/bronze.png');
}

.draggable-coin.silver {
    background-image: url('../resources/other/silver.png');
}

.draggable-coin:hover {
    transform: scale(1.1);
}

.draggable-coin.dragging {
    cursor: grabbing;
    opacity: 1;
    transform: scale(1.1);
}

.coins-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--coin-size), 1fr));
    gap: var(--spacing-sm);
    margin-top: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
    padding: var(--spacing-sm);
    background: rgba(0, 0, 0, 0.5);
    border-radius: var(--border-radius-md);
    min-height: clamp(50px, 10vh, 80px); /* Increased to accommodate larger coins */
    position: relative;
    z-index: 1;
    max-width: 100%;
    width: 100%;
    overflow: hidden; /* Changed from auto to hidden - no scrolling */
    box-sizing: border-box;
}

.player-character {
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: auto;
    box-sizing: border-box;
}

.character-info {
    background: rgba(90, 115, 80, 0.7);
    border: 2px solid var(--color-forest-moss);
    border-radius: 5px;
    padding: var(--spacing-sm);
    margin-top: var(--spacing-sm);
    color: var(--color-text-light); /* White text for dark backgrounds */
    display: flex;
    flex-direction: column;
    height: auto;
    box-sizing: border-box;
}

.character-name {
    color: var(--color-antique-gold);
    font-weight: bold;
    font-size: clamp(10px, 1.5vmin, 18px);
    margin-bottom: var(--spacing-xs);
    text-align: center;
    white-space: nowrap;
    line-height: 1.1;
    width: 100%;
    max-width: 100%;
    overflow: hidden;
}

.character-abilities {
    font-size: var(--font-medium); /* Consistent abilities text */
    line-height: 1.4;
    color: var(--color-text-light); /* White text for dark backgrounds */
}

.character-abilities p {
    color: inherit; /* Ensure paragraphs inherit white color from parent */
}

.player-resources {
    font-size: clamp(10px, 1.4vmin, 16px); /* Standardized font size */
    display: flex;
    flex-direction: row;
    gap: clamp(4px, 0.8vmin, 10px); /* Standardized spacing */
    align-items: center;
    flex-wrap: nowrap; /* Keep all items in single row */
    background: rgba(0, 0, 0, 0.4);
    padding: clamp(3px, 0.9vmin, 12px) clamp(4px, 1.3vmin, 16px);
    border-radius: 6px;
    border: 1px solid rgba(201, 169, 97, 0.3);
    width: 100%; /* Expand to full available width */
    box-sizing: border-box; /* Include padding in width calculation */
    overflow-x: auto; /* Allow horizontal scroll if needed */
    overflow-y: hidden;
    flex: 0 0 auto;
}

/* Human player resources - stack vertically */
#player-info-view .player-resources {
    flex-direction: column;
    align-items: stretch;
    gap: clamp(4px, 0.8vmin, 8px);
    padding: clamp(4px, 1vmin, 10px);
    overflow-y: auto;
    overflow-x: hidden;
    max-height: none;
    min-height: 0;
}

/* Ensure all resource rows in human player are visible */
#player-info-view .resource-row {
    flex-shrink: 0;
    min-height: 0;
}

#player-info-view .lands-row,
#player-info-view .inns-row {
    flex-wrap: nowrap;
}

.resource-group {
    display: flex;
    align-items: center;
    gap: 4px; /* More gap for better spacing */
    background: rgba(0, 0, 0, 0.3);
    padding: clamp(2px, 0.4vmin, 4px) clamp(3px, 0.6vmin, 6px);
    border-radius: 4px;
    white-space: nowrap;
}

.resource-label {
    color: #ffffff; /* White text for resources */
    font-weight: bold;
}

.resource-icon {
    font-size: clamp(10px, 1.2vmin, 14px); /* Standardized smaller size for consistency */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    text-align: center;
    vertical-align: middle;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
}

.lands-count, .inns-count, .treasures-count, .cultivated-count, .destroyed-count {
    color: var(--color-text-light);
    font-weight: bold;
    font-size: clamp(10px, 1.2vmin, 14px); /* Standardized to match icon size */
}

.cultivated-count {
    color: var(--color-success-green);
}

.destroyed-count {
    color: var(--color-danger-crimson);
}

/* Treasure details for human player */
.treasure-details {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    font-size: 0.8em;
}

.treasure-item {
    display: inline;
    color: var(--color-antique-gold);
    font-size: 0.9em;
}

.player-actions-section {
    display: flex;
    flex-direction: column;
    flex: 0 0 auto;
    min-height: 0;
    overflow: visible; /* Allow sticky buttons to be visible */
    transition: opacity 0.3s;
}

/* Dim the actions section when character is not selected */
body:has(#character-selection-view[style*="display: block"]) .player-actions-section {
    opacity: 0.4;
    pointer-events: none;
}

.player-actions-section h4 {
    color: var(--color-antique-gold);
    margin-bottom: var(--spacing-sm);
    font-size: var(--font-h4); /* Responsive heading */
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(clamp(70px, 12vw, 120px), 1fr));  /* Smaller buttons */
    gap: clamp(2px, 0.4vmin, 6px);  /* Smaller gaps */
    height: 100%;
    align-content: start;  /* Align to top */
}

.action-btn {
    background: linear-gradient(135deg, var(--color-forest-moss) 0%, var(--color-illuminated-blue) 100%);
    border: var(--border-width) solid var(--color-monastery-stone);
    border-radius: var(--border-radius-sm);
    padding: clamp(0.3em, 1vmin, 0.8em);  /* Reduced padding for more space */
    color: var(--color-text-light);
    cursor: pointer;
    font-size: clamp(10px, 1.8vmin, 16px);  /* Smaller, responsive font size */
    transition: all 0.2s;
    min-height: var(--action-button-height);
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: normal; /* Allow text to wrap into multiple lines */
    text-align: center; /* Center multi-line text */
    line-height: 1.2; /* Comfortable line spacing for wrapped text */
    word-break: break-word;  /* Break long words if needed */
    overflow: hidden;  /* Prevent overflow */
}

.action-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #5a7550 0%, #3a5f7b 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Remove background transparency from actions section (post-selection) */
body:not(.character-selection-phase) .player-actions-section.player-zone {
    background: rgb(45, 79, 107);  /* Fully opaque - no alpha channel */
}

/* Action button text */
.action-text {
    font-weight: 600;
    font-size: 0.8em;
}

/* Larger action text after character selection */
body:not(.character-selection-phase) .action-text {
    font-size: 0.8em !important;  /* Strengthen with !important */
}

/* Utility buttons container - always visible at bottom */
.utility-buttons-row {
    display: flex;
    gap: 10px;
    width: 100%;
    margin-top: 10px;
    position: sticky;
    bottom: 0;
    padding: 10px 0;
    z-index: 10;
}

.utility-buttons-row .btn-utility {
    flex: 1;
}

.btn-end-turn {
    background: linear-gradient(135deg, var(--color-warning-amber) 0%, var(--color-wax-seal-red) 100%);
    border-color: var(--color-burgundy);
    font-weight: bold;
    font-size: 1.2em;
}

/* Utility buttons (fullscreen, help) */
.btn-utility {
    background: linear-gradient(135deg, #4a5f70 0%, #2a3f50 100%);
    border-color: var(--color-monastery-stone);
    font-size: 1em;
}

.btn-utility:hover {
    background: linear-gradient(135deg, #5a7080 0%, #3a5060 100%);
    transform: translateY(-1px);
}

.btn-utility .fullscreen-icon,
.btn-utility .help-icon {
    font-size: 1.3em;
    margin-right: 6px;
    vertical-align: middle;
}

.btn-end-turn:hover:not(:disabled) {
    background: linear-gradient(135deg, #d18a20 0%, #9d4c4c 100%);
}

/* Dice Area - positioned at (1000, 110) on 1200x1311 board with 150x150 dimensions */
#dice-area {
    position: absolute;
    left: 83.33%; /* (1000/1200) * 100% */
    top: 8.39%; /* (110/1311) * 100% */
    width: 12.5%; /* (150/1200) * 100% */
    height: 11.44%; /* (150/1311) * 100% */
    transform: none; /* No centering transform */
    background: rgba(45, 79, 107, 0.3); /* Semi-transparent background to visualize position */
    padding: 0; /* Remove fixed padding to scale properly */
    border-radius: 8px;
    border: 2px solid rgba(201, 169, 97, 0.5); /* Visible border for debugging */
    text-align: center;
    transition: all 0.5s ease-in-out;
    z-index: 100;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: visible; /* Ensure dice aren't clipped */
}

/* Centered dice area during rolling */
#dice-area.centered {
    top: 50%;
    left: 50%;
    right: auto;
    bottom: auto;
    transform: translate(-50%, -50%);
    padding: clamp(20px, 4vmin, 50px);
    min-width: 20vmin; /* Scale with viewport instead of fixed 250px */
    background: rgba(45, 79, 107, 0.98);
    box-shadow: 0 0 80px rgba(0, 0, 0, 0.9);
}

/* Backdrop overlay when dice are centered */
#dice-area.centered::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: -1;
    pointer-events: none;
}

#dice-area h3 {
    color: var(--color-antique-gold);
    margin-bottom: var(--spacing-sm);
    font-size: var(--font-h4); /* Responsive dice title */
    transition: opacity 0.3s ease;
    display: none; /* Always hide the "Dados" text */
}

#dice-sum {
    font-size: var(--font-body); /* Consistent dice sum */
    font-weight: bold;
    color: var(--color-antique-gold);
    display: none; /* Always hide the sum */
}

#dice-display {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 8px;
    perspective: 1000px;
    perspective-origin: center center;
    transition: gap 0.3s ease;
}

#dice-area.centered #dice-display {
    gap: 30px;
    margin-bottom: 0;
    perspective: 1500px;
    perspective-origin: center center;
}

.die-container {
    width: var(--dice-size);
    height: var(--dice-size);
    position: relative;
    transition: all 0.3s ease;
}

#dice-area.centered .die-container {
    width: calc(var(--dice-size) * 1.2); /* Scale with dice size instead of fixed 100px */
    height: calc(var(--dice-size) * 1.2);
}

.die {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease-out;
    transform: rotateX(0deg) rotateY(0deg);
}

.die-face {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    border: 2px solid var(--color-antique-gold);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-dice); /* Consistent dice numbers */
    font-weight: bold;
    color: var(--color-text-light); /* Changed from dark to white text */
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

#dice-area.centered .die-face {
    font-size: clamp(28px, 4.5vmin, 70px); /* Larger for centered view (proportional) */
}

/* Position each face of the cube - dynamic based on dice size */
.die-container .face-1 {
    transform: rotateY(0deg) translateZ(calc(var(--dice-size) / 2));
}

.die-container .face-2 {
    transform: rotateY(90deg) translateZ(calc(var(--dice-size) / 2));
}

.die-container .face-3 {
    transform: rotateY(180deg) translateZ(calc(var(--dice-size) / 2));
}

.die-container .face-4 {
    transform: rotateY(-90deg) translateZ(calc(var(--dice-size) / 2));
}

.die-container .face-5 {
    transform: rotateX(90deg) translateZ(calc(var(--dice-size) / 2));
}

.die-container .face-6 {
    transform: rotateX(-90deg) translateZ(calc(var(--dice-size) / 2));
}

/* Position each face of the cube - centered (120% of normal size) */
#dice-area.centered .die-container .face-1 {
    transform: rotateY(0deg) translateZ(calc(var(--dice-size) * 1.2 / 2));
}

#dice-area.centered .die-container .face-2 {
    transform: rotateY(90deg) translateZ(calc(var(--dice-size) * 1.2 / 2));
}

#dice-area.centered .die-container .face-3 {
    transform: rotateY(180deg) translateZ(calc(var(--dice-size) * 1.2 / 2));
}

#dice-area.centered .die-container .face-4 {
    transform: rotateY(-90deg) translateZ(calc(var(--dice-size) * 1.2 / 2));
}

#dice-area.centered .die-container .face-5 {
    transform: rotateX(90deg) translateZ(calc(var(--dice-size) * 1.2 / 2));
}

#dice-area.centered .die-container .face-6 {
    transform: rotateX(-90deg) translateZ(calc(var(--dice-size) * 1.2 / 2));
}

/* Dice Rolling Animation */
@keyframes diceRoll {
    0% {
        transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
    }
    25% {
        transform: rotateX(360deg) rotateY(180deg) rotateZ(90deg);
    }
    50% {
        transform: rotateX(720deg) rotateY(360deg) rotateZ(180deg);
    }
    75% {
        transform: rotateX(1080deg) rotateY(540deg) rotateZ(270deg);
    }
    100% {
        transform: rotateX(1440deg) rotateY(720deg) rotateZ(360deg);
    }
}

.die-container.rolling .die {
    animation: diceRoll 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transition: none !important; /* Disable transition during animation */
}

#dice-area.rolling {
    border-color: var(--color-antique-gold);
    box-shadow: 0 0 20px rgba(201, 169, 97, 0.5);
    transition: all 0.3s ease;
}

/* Game Log Section (Bottom, collapsible) */
#game-log-section {
    background: rgba(45, 79, 107, 0.9);
    border: 2px solid var(--color-illuminated-blue);
    border-radius: 6px;
    margin: 0;
    padding: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    flex-shrink: 0;
}

#game-log-section.collapsed {
    margin: 0;
}

#game-log-section.collapsed .log-content {
    display: none;
}

.toggle-log-btn {
    width: 100%;
    padding: 10px;
    background: rgba(90, 84, 71, 0.8);
    color: var(--color-antique-gold);
    border: none;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    text-align: center;
    transition: background 0.2s;
}

.toggle-log-btn:hover {
    background: rgba(90, 84, 71, 1);
}

#game-log {
    padding: var(--spacing-sm);
    display: flex;
    flex-direction: column;
    height: var(--log-max-height);
    max-height: var(--log-max-height);
}

#game-log h3 {
    color: var(--color-antique-gold);
    font-size: var(--font-h4); /* Responsive log heading */
    margin: 0 0 var(--spacing-sm) 0;
}

#log-messages {
    flex: 1;
    overflow: hidden; /* Changed from auto to hidden - no scrolling */
    font-size: var(--font-tiny); /* Consistent log messages */
    display: flex;
    flex-direction: column-reverse; /* Show most recent at bottom */
}

.log-message {
    padding: 5px 0;
    border-bottom: 1px solid rgba(69, 123, 157, 0.3);
}

.log-message:last-child {
    border-bottom: none;
}

.log-event {
    color: var(--color-danger-crimson);
    font-weight: bold;
}

.log-action {
    color: var(--color-success-green);
}

.log-info {
    color: var(--color-text-light);
}

/* Modals */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    overflow-y: auto;
    padding: 40px 20px;
}

.modal.hidden {
    display: none;
}

/* Hide other content when difficulty modal is shown (not for character selection) */
#difficulty-modal:not(.hidden) ~ * {
    display: none;
}

#difficulty-modal:not(.hidden) {
    background: rgba(0, 0, 0, 0.98);
}

/* Character selection view inside player pane */
.character-selection-view {
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden; /* Changed from auto to hidden - no scrolling */
    padding: var(--spacing-sm);
    color: var(--color-text-light); /* White text for dark backgrounds */
}

#character-options-inline {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    flex: 1;
    height: 100%;
}

#character-options-inline .character-option {
    background: rgba(90, 115, 80, 0.7);
    border-radius: 8px;
    padding: var(--spacing-sm);
    cursor: pointer;
    transition: all 0.2s;
    color: var(--color-text-light);
    display: flex;
    flex-direction: column;
    flex: 1 1 0;
    max-height: 32vh;
    min-height: 0;
    box-sizing: border-box;
}

#character-options-inline .character-option:hover {
    background: rgba(90, 115, 80, 0.9);
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    border-color: var(--color-antique-gold);
}

/* Make character image container fill character option card */
#character-options-inline .character-option .character-image-container {
    flex: 1;
    min-height: 0;
}

/* Match opponent character font sizes */
#character-options-inline .character-abilities p {
    font-size: 0.8em;
}

/* Ensure player info view takes full height */
.player-info-view {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.modal-content {
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    border: var(--border-width) solid var(--color-illuminated-blue);
    border-radius: var(--border-radius-lg);
    padding: var(--modal-padding);
    max-width: var(--modal-max-width);
    width: 90%;
    max-height: 90vh;
    overflow: hidden; /* Changed from auto to hidden - no scrolling */
    margin: auto;
    display: flex;
    flex-direction: column;
    color: var(--color-text-light); /* Ensure white text in modals */
}

.modal-content h2 {
    color: var(--color-antique-gold);
    margin-bottom: var(--spacing-lg);
    text-align: center;
    font-size: var(--font-h2); /* Responsive modal heading */
}

/* Help Modal Specific Styles */
.help-modal-content {
    max-width: 700px;
    position: relative;
}

.close-help-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(122, 46, 46, 0.8);
    border: 2px solid var(--color-danger-crimson);
    color: white;
    width: 35px;
    height: 35px;
    min-width: 35px;
    min-height: 35px;
    padding: 0;
    border-radius: 50%;
    font-size: 1.5em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-sizing: border-box;
}

.close-help-btn:hover {
    background: var(--color-danger-crimson);
    transform: rotate(90deg);
}

/* Event Modal Specific Styles */
#event-modal {
    background: rgba(0, 0, 0, 0.85); /* More opaque background for event modal */
}

.event-modal-content {
    max-width: 450px;
    text-align: center;
    padding: 20px;
    background: rgba(26, 21, 16, 0.95); /* Opaque dark background to hide flip animation artifacts */
    border: 2px solid var(--color-illuminated-blue);
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
}

.event-card-large {
    width: 100%;
    height: 500px;
    margin: 0 auto;
    perspective: 1000px;
    overflow: hidden; /* Hide any overflow during flip animation */
}

/* Responsive event card for mobile landscape */
@media screen and (max-height: 768px) and (orientation: landscape) {
    .event-modal-content {
        max-width: 350px;
    }

    .event-card-large {
        height: 300px;
        max-height: 70vh;
    }

    #event-modal-description {
        font-size: 0.9em;
        line-height: 1.4;
        margin-top: 10px;
    }
}

.event-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.8s;
    transform-style: preserve-3d;
    background: transparent; /* Ensure no background interference */
}

.event-card-large.flipped .event-card-inner {
    transform: rotateY(180deg);
}

.event-card-back,
.event-card-front {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    background-color: rgba(26, 21, 16, 0.98); /* Solid background to prevent transparency */
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
}

.event-card-back {
    background-image: url('../resources/other/Event_Back.png');
}

.event-card-front {
    transform: rotateY(180deg);
}

#event-modal-description {
    color: var(--color-text-light);
    font-size: 1.1em;
    line-height: 1.6;
    margin-top: 20px;
}

/* Reshuffle Modal Specific Styles */
#reshuffle-modal {
    background: rgba(0, 0, 0, 0.9); /* Dark background */
}

.reshuffle-modal-content {
    max-width: 700px;
    width: 90%;
    text-align: center;
    padding: 40px 20px;
    background: rgba(26, 21, 16, 0.95);
    border: 2px solid var(--color-illuminated-blue);
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
}

.reshuffle-decks-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: center;
    justify-items: center;
}

.reshuffle-deck-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.reshuffle-deck-label {
    color: var(--color-antique-gold);
    font-size: 1.2em;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
}

.reshuffle-deck {
    position: relative;
    width: 200px;
    height: 280px;
    perspective: 1000px;
}

.reshuffle-card-stack {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
}

.reshuffle-card {
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    backface-visibility: hidden;
}

/* Event deck card - initially transparent, shows card back */
.event-deck-card {
    background-image: url('../resources/other/Event_Back.png');
    background-color: rgba(26, 21, 16, 0.98);
    opacity: 0;
}

/* Discard pile card - shows last discarded event */
.discard-pile-card {
    background-color: rgba(26, 21, 16, 0.98);
}

/* Animation state classes */
.reshuffle-card-stack.moving .discard-pile-card {
    animation: deckMove 2s ease-in-out forwards, deckFlip 2s ease-in-out forwards;
}

.reshuffle-card-stack.moving .event-deck-card {
    animation: deckFadeIn 2s ease-in-out forwards;
}

.reshuffle-card-stack.shuffling .event-deck-card {
    animation: shuffleBlur 2s ease-in-out forwards;
}

.reshuffle-card-stack.settling .event-deck-card {
    animation: deckSettle 0.4s ease-out forwards;
}

/* Keyframe Animations */

/* Move cards from discard pile (right) to event deck (left) */
@keyframes deckMove {
    0% {
        transform: translateX(0) translateY(0);
    }
    100% {
        transform: translateX(-240px) translateY(0);
        opacity: 0;
    }
}

/* Flip card from face-up to face-down during movement */
@keyframes deckFlip {
    0% {
        transform: translateX(0) rotateY(0deg);
    }
    50% {
        transform: translateX(-120px) rotateY(90deg);
    }
    100% {
        transform: translateX(-240px) rotateY(180deg);
        opacity: 0;
    }
}

/* Fade in event deck as cards arrive */
@keyframes deckFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

/* Rapid rotation with blur effect for shuffling */
@keyframes shuffleBlur {
    0% {
        opacity: 1;
        transform: rotate(0deg) scale(1);
        filter: blur(0px);
    }
    25% {
        opacity: 1;
        transform: rotate(180deg) scale(1.1);
        filter: blur(8px);
    }
    50% {
        opacity: 1;
        transform: rotate(360deg) scale(1);
        filter: blur(12px);
    }
    75% {
        opacity: 1;
        transform: rotate(540deg) scale(1.1);
        filter: blur(8px);
    }
    100% {
        opacity: 1;
        transform: rotate(720deg) scale(1);
        filter: blur(0px);
    }
}

/* Settle animation - deck solidifies */
@keyframes deckSettle {
    0% {
        transform: rotate(720deg) scale(1.05);
        filter: blur(2px);
    }
    100% {
        transform: rotate(720deg) scale(1);
        filter: blur(0px);
    }
}

/* Responsive reshuffle modal for mobile landscape */
@media screen and (max-height: 768px) and (orientation: landscape) {
    .reshuffle-modal-content {
        max-width: 600px;
        padding: 20px 15px;
    }

    .reshuffle-decks-container {
        gap: 30px;
    }

    .reshuffle-deck {
        width: 150px;
        height: 210px;
    }

    .reshuffle-deck-label {
        font-size: 1em;
    }
}

@media screen and (max-width: 640px) {
    .reshuffle-modal-content {
        max-width: 90%;
        padding: 15px;
    }

    .reshuffle-decks-container {
        gap: 20px;
    }

    .reshuffle-deck {
        width: 120px;
        height: 168px;
    }

    .reshuffle-deck-label {
        font-size: 0.9em;
    }
}

.help-section {
    margin-bottom: 25px;
    background: rgba(74, 93, 63, 0.4);
    padding: 20px;
    border-radius: 10px;
    border: 2px solid var(--color-illuminated-blue);
}

.help-section h3 {
    color: var(--color-antique-gold);
    margin-bottom: var(--spacing-md);
    font-size: var(--font-h3); /* Responsive help section heading */
}

.help-section p {
    color: var(--color-text-light);
    line-height: 1.6;
    font-size: var(--font-small); /* Consistent help text */
}

/* Character Info Modal - Position higher on screen */
#character-info-modal {
    align-items: flex-start;
    padding-top: 20px;
}

/* Character Info Modal Styles */
.character-info-modal-content {
    max-width: 90vw;
    max-height: 95vh;
    overflow: hidden;
    padding: var(--modal-padding);
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    border: 2px solid var(--color-antique-gold);
    display: flex;
    flex-direction: column;
}

.character-info-modal-content h2 {
    color: var(--color-antique-gold);
    font-size: var(--font-h2);
    margin-bottom: var(--spacing-lg);
    text-align: center;
}

.character-modal-abilities {
    background: rgba(74, 93, 63, 0.4);
    padding: var(--spacing-lg);
    border-radius: var(--border-radius-md);
    border: 2px solid var(--color-forest-moss);
}

.character-modal-abilities h3 {
    font-size: var(--font-h3);
    margin-bottom: var(--spacing-md);
}

.character-modal-abilities ul li {
    font-size: var(--font-medium);
    line-height: 1.6;
    color: var(--color-text-light);
}

.close-character-info-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 35px;
    height: 35px;
    background: var(--color-burgundy);
    border: none;
    border-radius: 50%;
    color: var(--color-text-light);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    z-index: 10;
}

/* Character Image Styles */
.character-image-container {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: var(--spacing-sm);
}

/* Character image in selection screen - FULL IMAGE */
.character-image-selection {
    width: 100%;
    max-width: 400px; /* Increased to show full character */
    max-height: 500px; /* Add max height to fit screen */
    height: auto;
    object-fit: contain; /* Ensure full image is visible */
    border-radius: var(--border-radius-md);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s;
    cursor: pointer;
}

.character-image-selection:hover {
    transform: scale(1.02);
}

/* Select character button */
.btn-select-character {
    width: 100%;
    max-width: 500px;
    margin: var(--spacing-md) auto 0;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-antique-gold);
    border: 2px solid var(--color-gold-border);
    border-radius: var(--border-radius-md);
    color: var(--color-monastery-stone);
    font-size: var(--font-medium);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    display: block;
}

.btn-select-character:hover {
    background: var(--color-gold-border);
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(201, 169, 97, 0.5);
}

/* Select character button in modal */
.btn-select-character-modal {
    width: 100%;
    padding: var(--spacing-lg);
    background: var(--color-antique-gold);
    border: 2px solid var(--color-gold-border);
    border-radius: var(--border-radius-md);
    color: var(--color-monastery-stone);
    font-size: var(--font-large);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    display: block;
}

.btn-select-character-modal:hover {
    background: var(--color-gold-border);
}

/* Cancel character button in modal */
.btn-cancel-character-modal {
    width: 100%;
    padding: var(--spacing-lg);
    background: var(--color-monastery-stone);
    border: 2px solid var(--color-antique-gold);
    border-radius: var(--border-radius-md);
    color: var(--color-antique-gold);
    font-size: var(--font-large);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    display: block;
}

.btn-cancel-character-modal:hover {
    background: var(--color-dark-vellum);
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(201, 169, 97, 0.5);
}

/* Unified character image container - for all players (human and AI) */
.character-image-container {
    width: 100%;
    height: 80%;
}

/* Unified character image - fill container while maintaining aspect ratio */
.character-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: var(--border-radius-sm);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: transform 0.2s;
}

.character-image:hover {
    transform: scale(1.05);
}

/* Hide character images after character selection (keep names visible) */
body:not(.character-selection-phase) .character-image-container {
    display: none;
}

body:not(.character-selection-phase) .character-image {
    display: none;
}

/* Center character names after character selection */
body:not(.character-selection-phase) .character-name {
    text-align: center;
}

/* Character Selection Phase Specific Styles */
/* Hide player resources during character selection phase */
/* MUST be more specific than #ai-players-column .player-resources to override it */
.character-selection-phase #ai-players-column .player-resources,
.character-selection-phase #ai-player-1 .player-resources,
.character-selection-phase #ai-player-2 .player-resources,
.character-selection-phase #player-human .player-resources {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}

/* Adjust parent container to flex column layout during selection */
.character-selection-phase #player-human {
    display: flex;
    flex-direction: column;
}

/* During character selection, adjust layout to show both views properly */
.character-selection-phase #player-info-view {
    height: auto !important; /* Don't take full height */
    flex: 0 0 auto; /* Don't grow */
    margin-bottom: var(--spacing-md);
}

.character-selection-phase #character-selection-view {
    height: auto !important; /* Don't take full height */
    flex: 1 1 auto; /* Take remaining space */
    overflow-y: auto; /* Allow scrolling if needed */
}

/* Hide coins container and character info during selection - ONLY for human player */
.character-selection-phase #player-human .coins-container,
.character-selection-phase #player-human .player-character {
    display: none !important;
}

/* AI player section height constraints - during character selection */
.character-selection-phase #ai-player-1 .player-header,
.character-selection-phase #ai-player-2 .player-header {
    height: 5vh !important;
    max-height: 5vh !important;
    flex: 0 0 5vh !important;
    box-sizing: border-box !important;
}

/* Ensure character options container fills space and allows scrolling */
.character-selection-phase #character-options-inline {
    flex: 1 1 auto;
    overflow-y: auto;
}

/* Character modal layout - two columns */
.character-modal-layout {
    display: flex;
    flex-direction: row;
    gap: var(--spacing-lg);
    width: 100%;
    height: 90vh;
    align-items: center;
}

/* Character image in modal (high-res) */
.character-modal-image-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    height: 100%;
}

.character-image-modal {
    height: 75vh;
    width: auto;
    max-width: 100%;
    object-fit: contain;
    border-radius: var(--border-radius-md);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}

/* Buttons column on the right */
.character-modal-buttons-column {
    display: flex;
    flex-direction: column;
    gap: 32px;
    justify-content: center;
    min-width: 120px;
    max-width: 150px;
}

.close-character-info-btn:hover {
    background: var(--color-danger-crimson);
    transform: rotate(90deg);
}

/* Make character info sections visually indicate they're clickable */
.character-info:hover {
    background: rgba(90, 115, 80, 0.9) !important;
    transform: scale(1.02);
    transition: all 0.2s;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.hotkeys-grid {
    display: grid;
    gap: 10px;
}

.hotkey-row {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 8px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 6px;
}

.hotkey-row kbd {
    background: linear-gradient(135deg, var(--color-illuminated-blue) 0%, var(--color-forest-moss) 100%);
    color: var(--color-antique-gold);
    padding: 5px 12px;
    border-radius: 6px;
    border: 2px solid var(--color-monastery-stone);
    font-family: monospace;
    font-size: 0.9em;
    min-width: 50px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    font-weight: bold;
}

.hotkey-row span {
    color: var(--color-text-light);
    flex: 1;
}

.info-grid {
    display: grid;
    gap: 12px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 6px;
}

.info-row strong {
    color: var(--color-antique-gold);
}

.info-row span {
    color: var(--color-text-light);
}

#character-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(clamp(150px, 25vw, 250px), 1fr));
    gap: var(--spacing-md);
    overflow: hidden;
}

#guild-options {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: clamp(8px, 1vw, 12px);
    max-width: 900px;
    margin: 0 auto;
    padding: var(--spacing-sm);
}

.character-option {
    background: rgba(90, 115, 80, 0.7);
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: all 0.2s;
}

.guild-option {
    border: 2px solid var(--color-forest-moss);
    padding: 0;
    aspect-ratio: 2 / 3;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.2s;
    border-radius: 6px;
    max-height: 180px;
}

.guild-option.guild-blocked {
    opacity: 0.6;
    border-color: #ff6b6b;
}

.guild-option.guild-blocked::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 0, 0, 0.2);
    pointer-events: none;
}

/* Override: Character options have transparent background */
.character-option {
    background: transparent !important;
}

.character-option:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.guild-option:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
    border-color: var(--color-gold);
}

.guild-option.guild-blocked:hover {
    border-color: #ff6b6b;
}

/* Responsive guild grid for smaller screens */
@media (max-width: 900px) {
    #guild-options {
        max-width: 700px;
        gap: 6px;
    }

    .guild-option {
        max-height: 140px;
    }
}

@media (max-width: 640px) {
    #guild-options {
        max-width: 100%;
        gap: 4px;
        padding: 4px;
    }

    .guild-option {
        max-height: 100px;
        border-width: 1px;
        border-radius: 4px;
    }
}

@media (max-width: 480px) {
    #guild-options {
        grid-template-columns: repeat(5, 1fr);
        gap: 3px;
    }

    .guild-option {
        max-height: 70px;
    }
}

.character-option h3, .guild-option h3 {
    color: var(--color-antique-gold);
    font-size: var(--font-h3); /* Responsive option heading */
    margin-bottom: var(--spacing-sm);
}

.character-option p, .guild-option p {
    font-size: var(--font-small); /* Consistent option text */
    line-height: 1.4;
    color: var(--color-text-light);
}

.event-option {
    background: rgba(90, 115, 80, 0.7);
    border: 2px solid var(--color-forest-moss);
    border-radius: 8px;
    padding: 5px;
    cursor: pointer;
    transition: all 0.2s;
}

.event-option:hover {
    background: rgba(90, 115, 80, 0.9);
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.btn-primary, .btn-secondary {
    padding: var(--spacing-sm) var(--spacing-lg);
    border-radius: var(--border-radius-md);
    border: none;
    cursor: pointer;
    font-size: var(--font-body); /* Consistent button text */
    font-weight: bold;
    transition: all 0.2s;
}

.btn-primary {
    background: linear-gradient(135deg, var(--color-forest-moss) 0%, var(--color-illuminated-blue) 100%);
    color: var(--color-text-light);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #5a7550 0%, #3a5f7b 100%);
    transform: translateY(-2px);
}

.btn-secondary {
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    color: var(--color-text-light);
    margin-top: 15px;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #6b6053 0%, #3d3526 100%);
}

/* Difficulty Selection */
#difficulty-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.difficulty-option {
    background: rgba(90, 115, 80, 0.7);
    border: 2px solid var(--color-forest-moss);
    border-radius: var(--border-radius-md);
    padding: var(--spacing-lg);
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    width: 100%;
    font-family: inherit;
    color: var(--color-text-light); /* Changed from inherit to white */
}

.difficulty-option:hover {
    background: rgba(90, 115, 80, 0.9);
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.difficulty-option h3 {
    color: var(--color-antique-gold);
    font-size: var(--font-xxl); /* Consistent difficulty heading */
    margin-bottom: var(--spacing-sm);
}

.difficulty-option p {
    color: var(--color-text-light);
    font-size: var(--font-xl); /* Consistent difficulty description */
    margin: 0;
    line-height: 1.5;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(90, 84, 71, 0.5);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: var(--color-illuminated-blue);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: #3a5f7b;
}

/* Responsive Design */
/* Tablet landscape (iPad Pro and similar) */
@media (max-width: 1200px) and (min-width: 769px) {
    :root {
        --base-font-size: clamp(9px, 1.3vmin, 22px);
        --spacing-unit: clamp(2px, 0.35vmin, 7px);
        --body-padding: clamp(4px, 0.8vmin, 10px);
        --game-board-gap: clamp(3px, 0.7vmin, 10px);
        --guild-grid-min-height: clamp(180px, 35vh, 350px);
    }

    #guilds-grid {
        width: 98%;
    }

    .player-zone {
        font-size: 0.9em;
    }

    /* Most styling now handled by CSS variables */
    .character-abilities {
        font-size: 0.85em;
    }

    .player-resources {
        font-size: clamp(10px, 1.4vmin, 16px); /* Standardized font size */
    }

    /* All other styling handled by CSS variables */
}

/* REMOVED: Portrait mode layout rearrangement
   The game now maintains its 3-column layout on all screen sizes
   to prevent items from moving to different positions */

/* ===========================
   Landscape Prompt Modal Styles
   =========================== */

.landscape-prompt-content {
    text-align: center;
    padding: 30px;
    max-width: 450px;
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    border: 2px solid var(--color-antique-gold);
}

.landscape-prompt-content h2 {
    color: var(--color-antique-gold);
    margin-bottom: 25px;
    font-size: 1.5em;
}

/* Make landscape prompt BLOCKING in portrait mode */
#landscape-prompt-modal:not(.hidden) {
    z-index: 9999 !important;
    background: rgba(0, 0, 0, 0.95) !important;
    pointer-events: auto !important;  /* Ensure modal captures all clicks */
}

/* Portrait mode - show larger rotate message */
@media (orientation: portrait) {
    .landscape-prompt-content {
        padding: 40px 30px;
        border: 3px solid var(--color-antique-gold);
    }

    .landscape-prompt-content h2 {
        font-size: 1.8em;
        animation: attention-pulse 1.5s ease-in-out infinite;
    }

    .landscape-message {
        font-size: 1.3em !important;
    }

    .rotate-phone-icon {
        font-size: 1.2em;
    }

    @keyframes attention-pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }
}

.landscape-icon-container {
    margin: 30px 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

.rotate-phone-icon {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    animation: pulse-rotation 2s ease-in-out infinite;
}

.phone-icon {
    font-size: 4em;
    display: inline-block;
    animation: rotate-device 3s ease-in-out infinite;
}

.rotation-arrow {
    font-size: 3em;
    color: var(--color-forest-moss);
    animation: arrow-spin 3s linear infinite;
}

@keyframes rotate-device {
    0%, 100% {
        transform: rotate(0deg);
    }
    25%, 75% {
        transform: rotate(0deg);
    }
    50% {
        transform: rotate(90deg);
    }
}

@keyframes arrow-spin {
    0% {
        transform: rotate(0deg);
        opacity: 1;
    }
    50% {
        transform: rotate(180deg);
        opacity: 0.6;
    }
    100% {
        transform: rotate(360deg);
        opacity: 1;
    }
}

@keyframes pulse-rotation {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.landscape-message {
    font-size: 1.1em;
    line-height: 1.5;
    margin-bottom: 25px;
    color: var(--color-text-light);
}

.landscape-prompt-content .btn-primary {
    width: 100%;
    margin-bottom: 12px;
    padding: 14px;
    font-size: 1.05em;
}

.landscape-prompt-content .btn-secondary {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.landscape-prompt-content .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.15);
}

/* ===========================
   Low Resolution Blocking Modal
   =========================== */

.low-resolution-blocking:not(.hidden) {
    z-index: 10000 !important; /* Above everything */
    background: rgba(0, 0, 0, 0.98) !important;
    display: flex !important; /* Ensure it displays as flex when not hidden */
}

.low-resolution-content {
    text-align: center;
    padding: 30px;
    max-width: 500px;
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    border: 2px solid var(--color-danger-crimson);
}

.low-resolution-content h2 {
    color: var(--color-danger-crimson);
    margin-bottom: 20px;
    font-size: 1.6em;
}

.warning-icon {
    font-size: 4em;
    margin: 20px 0;
    animation: warning-pulse 2s ease-in-out infinite;
}

@keyframes warning-pulse {
    0%, 100% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.1);
        opacity: 0.8;
    }
}

.warning-message {
    font-size: 1.2em;
    line-height: 1.6;
    margin-bottom: 25px;
    color: var(--color-text-light);
}

.suggestions {
    text-align: left;
    background: rgba(74, 93, 63, 0.4);
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border: 2px solid var(--color-forest-moss);
}

.suggestions h3 {
    color: var(--color-antique-gold);
    margin-bottom: 15px;
    font-size: 1.1em;
}

.suggestions ul {
    list-style: none;
    padding-left: 0;
}

.suggestions li {
    padding: 8px 0;
    font-size: 1em;
    line-height: 1.5;
    color: var(--color-text-light);
}

.suggestions li strong {
    color: var(--color-antique-gold);
}

.min-resolution-note {
    margin-top: 20px;
    font-size: 0.9em;
    color: var(--color-text-muted);
    font-style: italic;
}

#try-fullscreen-low-res-btn {
    width: 100%;
    padding: 14px;
    font-size: 1.1em;
    margin: 15px 0;
}

/* Hide game content when low resolution modal is shown */
body.low-resolution-blocked #game-container {
    display: none;
}

body.low-resolution-blocked #fullscreen-btn {
    display: none;
}

body.low-resolution-blocked #difficulty-modal {
    display: none !important;
}

/* ===========================
   iOS Add to Home Screen Instructions Modal
   =========================== */

.ios-instructions-content {
    text-align: center;
    padding: 30px;
    max-width: 550px;
    background: linear-gradient(135deg, var(--color-monastery-stone) 0%, var(--color-dark-vellum) 100%);
    border: 2px solid var(--color-illuminated-blue);
}

.ios-instructions-content h2 {
    color: var(--color-illuminated-blue);
    margin-bottom: 15px;
    font-size: 1.5em;
}

.ios-intro {
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 25px;
    color: var(--color-text-light);
}

.ios-steps {
    text-align: left;
    margin: 25px 0;
}

.ios-step {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(74, 122, 160, 0.15);
    border-radius: 10px;
    border-left: 3px solid var(--color-illuminated-blue);
}

.step-number {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    background: var(--color-illuminated-blue);
    color: var(--color-text-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1em;
}

.step-content {
    flex-grow: 1;
}

.step-content p {
    margin: 5px 0;
    color: var(--color-text-light);
}

.step-content strong {
    color: var(--color-antique-gold);
    font-size: 1.05em;
}

.step-icon {
    font-size: 2em;
    margin: 10px 0;
}

.step-detail {
    font-size: 0.9em;
    color: var(--color-text-muted);
    font-style: italic;
}

.ios-benefits {
    text-align: left;
    background: rgba(90, 117, 80, 0.25);
    padding: 18px;
    border-radius: 10px;
    margin: 20px 0;
    border: 2px solid var(--color-forest-moss);
}

.ios-benefits p {
    color: var(--color-antique-gold);
    margin-bottom: 12px;
    font-weight: bold;
}

.ios-benefits ul {
    list-style: none;
    padding-left: 0;
}

.ios-benefits li {
    padding: 6px 0;
    font-size: 0.95em;
    color: var(--color-text-light);
}

.ios-note {
    margin-top: 15px;
    font-size: 0.85em;
    color: var(--color-text-muted);
    font-style: italic;
}

#close-ios-instructions-btn {
    width: 100%;
    padding: 14px;
    font-size: 1.1em;
    margin: 15px 0 10px 0;
}

/* ===========================
   Mobile Landscape Optimizations
   =========================== */

/* Mobile Landscape - Optimized for phones in horizontal orientation */
@media screen and (max-height: 768px) and (orientation: landscape) {
    :root {
        --base-font-size: clamp(8px, 1.1vmin, 18px);
        --spacing-unit: clamp(1px, 0.2vmin, 4px);
        --spacing-xs: clamp(1px, 0.2vmin, 3px);
        --spacing-sm: clamp(2px, 0.3vmin, 4px);
        --spacing-md: clamp(2px, 0.4vmin, 6px);
        --body-padding: clamp(1px, 0.2vmin, 2px);
        --game-board-gap: clamp(2px, 0.3vmin, 3px);
        --guild-grid-min-height: clamp(150px, 30vh, 250px);
        --coin-size: clamp(20px, 3.5vmin, 36px); /* Proportional to placeholder size */
        --dice-size: clamp(60px, 8vmin, 90px); /* Larger minimum for proper 3D cube effect */
        --action-button-height: clamp(16px, 2.5vh, 24px);
        --investment-slot-size: clamp(10px, 1.5vmin, 14px);
        --guild-number-size: clamp(10px, 1.8vmin, 14px);
        --border-width: 1px;
    }

    body {
        overflow-y: auto !important; /* Allow vertical scrolling on extreme low-res */
        max-height: none !important;
    }

    html {
        overflow-y: auto !important; /* Allow vertical scrolling on extreme low-res */
    }

    #game-container {
        max-width: 100%;
        overflow: visible !important; /* Override base CSS overflow: hidden */
        max-height: none !important; /* Remove height constraint */
        height: auto !important; /* Allow natural height */
    }

    /* CRITICAL: Optimized ratio for landscape devices with limited height */
    #game-board {
        /* Optimized proportions: Human (21%) | Board (58%) | AI Players (21%) */
        grid-template-columns: 0.85fr 2.3fr 0.85fr !important;
        gap: clamp(2px, 0.3vmin, 3px);
        margin-bottom: clamp(2px, 0.3vmin, 4px);
        overflow: visible !important; /* Override base CSS overflow: hidden */
    }

    /* Ensure guilds area is fully visible and elements align */
    #board-column {
        padding: 0;
        overflow: visible !important;
        display: flex;
        align-items: center;
        justify-content: center;
        max-height: none; /* Remove height constraint to prevent cropping */
    }

    /* CRITICAL: Board must maintain aspect ratio and fit within viewport */
    #guilds-grid {
        /* Use width-based sizing with aspect-ratio controlling height */
        width: calc(92vh * 1200 / 1311); /* Width constrained by viewport height */
        height: auto; /* Let aspect-ratio calculate height */
        max-width: 100%; /* Don't exceed container width */
        margin: 0 auto;
        box-sizing: border-box;
        /* Aspect ratio 1200:1311 from original Board.png - always maintained */
        aspect-ratio: 1200 / 1311;
        position: relative;
        /* REMOVED transform: scale() to fix percentage positioning alignment */
    }

    /* HIDE actions pane completely during character selection on mobile */
    body.character-selection-phase .player-actions-section {
        display: none !important;
        height: 0 !important;
        min-height: 0 !important;
        max-height: 0 !important;
        overflow: hidden !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    /* SHOW actions section during gameplay */
    body:not(.character-selection-phase) .player-actions-section {
        display: flex !important;
    }

    /* Expand character selection view to use ALL available space */
    #character-selection-view:not([style*="display: none"]) {
        height: 100%;
        max-height: 100%;
        width: 100%;
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: visible;
        padding: clamp(6px, 1vmin, 12px);
    }

    /* When character selection is shown, expand to use ALL available space */
    body.character-selection-phase #player-human {
        height: 100vh !important;
        max-height: 100vh !important;
        flex: 1 !important;
        width: 100% !important;
    }

    body.character-selection-phase #human-column {
        height: 100% !important;
        max-height: 100vh !important;
        width: 100% !important;
        grid-column: 1 / 2 !important; /* Stay in first column but expand */
    }

    /* Character selection view uses full available width */
    body.character-selection-phase #character-selection-view,
    body:has(#character-selection-view:not([style*="display: none"])) #character-selection-view {
        width: 100% !important;
        max-width: 100% !important;
    }

    /* OPTIMIZE PLAYER PANE SPACING */
    .player-zone {
        max-height: 46vh;
        min-height: auto;
        padding: clamp(2px, 0.4vmin, 5px) !important;
        overflow: hidden; /* Contain content */
    }

    /* CRITICAL: Allow player actions section to grow for end turn button */
    .player-actions-section {
        max-height: none !important; /* Override player-zone constraint */
        overflow: visible !important; /* Show end turn button */
        flex: 1 1 auto; /* Allow to grow */
    }

    /* Keep grid layout - don't override to flex */
    #human-column {
        gap: clamp(1px, 0.25vmin, 3px);
        padding: clamp(2px, 0.4vmin, 5px) !important;
        max-height: none; /* Allow section to grow for end turn button */
        overflow: visible; /* Show all content including end turn button */
        /* display: flex removed - keep grid layout from base styles */
    }

    /* Fix grid rows for mobile landscape - prevent resources section from collapsing */
    body:not(.character-selection-phase) #human-column {
        grid-template-rows: minmax(0, 12vh) minmax(120px, auto) 1fr !important;  /* Header (max 12vh), resources (min 120px), actions (remaining) */
    }

    #ai-players-column {
        gap: clamp(20px, 4vmin, 40px) !important;
        padding: clamp(2px, 0.4vmin, 5px) !important;
        max-height: 100vh;
        overflow: hidden; /* Prevent overflow */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    #ai-players-column .player-zone {
        min-height: 18vh;
        max-height: 50vh; /* Each AI pane gets 50vh */
        overflow-y: auto; /* Allow scrolling if needed */
        flex: 1;
    }

    /* Compact player info view */
    .player-info-view {
        gap: clamp(2px, 0.3vmin, 4px);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        flex: 1;
    }

    /* Ensure AI player info views can expand properly */
    #ai-players-column .player-info-view {
        height: 100%;
    }

    #ai-players-column .player-character {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-height: 0;
    }

    /* Reduce character info padding */
    .character-info {
        padding: clamp(2px, 0.4vmin, 5px) !important;
        margin-top: clamp(1px, 0.2vmin, 3px) !important;
        overflow: hidden;
        max-height: 18vh;
        overflow-y: auto;
    }

    /* Extend character info for AI opponents to use available space */
    #ai-players-column .character-info {
        max-height: 32vh !important;
        flex: 1;
    }

    /* Override max-height during character selection to allow full image display */
    body.character-selection-phase #ai-players-column .character-info {
        max-height: none !important;
        height: 100% !important;
    }

    .character-name {
        font-size: clamp(10px, 1.5vmin, 16px) !important;
        margin-bottom: clamp(2px, 0.3vmin, 4px) !important;
        white-space: nowrap !important;
        line-height: 1.1 !important;
        width: 100% !important;
        max-width: 100% !important;
        overflow: hidden !important;
    }

    /* AI players slightly smaller to fit long names */
    #ai-players-column .character-name {
        font-size: clamp(9px, 1.3vmin, 14px) !important;
    }

    .character-abilities {
        font-size: clamp(9px, 1.2vmin, 13px) !important;
        line-height: 1.2 !important;
    }

    .character-abilities p {
        margin-bottom: clamp(1px, 0.2vmin, 2px) !important;
    }

    /* Character selection - TWO ROWS layout (horizontal) - FULL WIDTH */
    #character-options-inline {
        gap: 0.5em;
        overflow: hidden;
        flex: 1;
        grid-template-rows: 1fr 1fr; /* Two rows */
        grid-auto-flow: column; /* Fill horizontally */
        grid-auto-columns: 1fr; /* Equal width columns */
        max-height: 100%;
        width: 100%;
    }

    /* Character option buttons - expanded for more space */
    #character-options-inline .character-option {
        margin-bottom: 0;
        font-size: 1em;
        max-height: 90%;
    }

    /* Character selection title - larger with more space */
    .character-selection-view h2 {
        font-size: clamp(18px, 3vmin, 26px) !important;
        margin-bottom: clamp(8px, 1.2vmin, 16px) !important;
        line-height: 1.2;
        padding: clamp(4px, 0.6vmin, 8px);
        text-align: center;
    }

    /* Reduce player actions section spacing */
    .player-actions-section {
        padding: 0;
        gap: clamp(2px, 0.3vmin, 4px);
    }

    .player-actions-section h4 {
        margin-bottom: clamp(3px, 0.5vmin, 6px);
        font-size: clamp(14px, 2vmin, 20px);
    }

    /* Reduce resource text size for more space */
    .player-resources {
        font-size: clamp(10px, 1.4vmin, 16px); /* Standardized font size */
    }

    .resource-group {
        font-size: 0.95em;
    }

    .lands-count,
    .inns-count,
    .treasures-count {
        font-size: 1em;
    }

    /* Player header - compact layout */
    .player-header {
        flex-direction: row;
        align-items: baseline;  /* Use baseline for proper text alignment */
        justify-content: space-between;
        flex-wrap: nowrap;
    }

    .player-name {
        font-size: clamp(10px, 1.7vmin, 20px); /* Standardized across all players */
        white-space: nowrap;
        flex-shrink: 1;
        min-width: 0;
    }

    .player-coins,
    .player-vp {
        font-size: clamp(12px, 1.5vmin, 20px); /* Larger coins and VP */
        white-space: nowrap;
        flex-shrink: 0;
    }

    /* Player color indicator removed */

    /* Fixed resource display - keep column layout for 3 rows */
    .player-resources {
        display: flex;
        flex-direction: column; /* Keep vertical stacking of 3 rows */
        flex-wrap: nowrap;
        font-size: clamp(10px, 1.4vmin, 16px);
        gap: clamp(2px, 0.4vmin, 4px); /* Minimal vertical spacing */
        width: 100%;
        overflow: visible; /* Allow all rows to be visible */
        flex: 0 0 auto; /* Don't grow or shrink */
    }

    .resource-group {
        font-size: 1em; /* Inherit from parent */
        display: inline-flex;
        flex-direction: row;
        align-items: center;
        gap: var(--spacing-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
        background: rgba(0, 0, 0, 0.5); /* Better background for contrast */
        border-radius: var(--border-radius-sm);
        white-space: nowrap;
    }

    .resource-label {
        font-weight: bold;
        min-width: max-content;
    }

    /* Inline treasure breakdown - compact for landscape mode */
    .treasure-breakdown-inline {
        gap: clamp(3px, 0.6vmin, 6px);
        padding: clamp(1px, 0.3vmin, 3px);
        margin: 0 clamp(2px, 0.4vmin, 4px);
    }

    /* Extra small treasure icons for landscape */
    .resource-icon-small {
        width: clamp(14px, 1.8vmin, 24px);
        height: clamp(14px, 1.8vmin, 24px);
    }

    /* Extra small treasure counts for landscape */
    .resource-count-small {
        font-size: clamp(9px, 1.2vmin, 16px);
        min-width: clamp(12px, 1.6vmin, 20px);
    }

    /* Treasure breakdown item spacing */
    .treasure-breakdown-item {
        gap: clamp(2px, 0.4vmin, 4px);
    }

    /* Ultra-compact resource icons for landscape - HUMAN PLAYER */
    #player-info-view .resource-icon-large {
        width: clamp(18px, 2.2vmin, 26px) !important;
        height: clamp(18px, 2.2vmin, 26px) !important;
    }

    /* Ultra-compact resource icons for landscape - AI PLAYERS */
    #ai-players-column .resource-icon-large {
        width: clamp(12px, 1.6vmin, 20px) !important;
        height: clamp(12px, 1.6vmin, 20px) !important;
    }

    /* Ultra-compact resource text for landscape - HUMAN PLAYER */
    #player-info-view .resource-count {
        font-size: clamp(10px, 1.4vmin, 18px) !important;
        min-width: clamp(14px, 2vmin, 24px);
    }

    /* Ultra-compact resource text for landscape - AI PLAYERS */
    #ai-players-column .resource-count {
        font-size: clamp(8px, 1.1vmin, 14px) !important;
        min-width: clamp(12px, 1.6vmin, 20px);
    }

    /* Minimal row spacing for landscape */
    .resource-row {
        gap: clamp(3px, 0.6vmin, 6px) !important;
        margin: clamp(1px, 0.2vmin, 2px) 0 !important;
    }

    .resource-item {
        gap: clamp(2px, 0.4vmin, 4px) !important;
    }

    .lands-count,
    .inns-count,
    .treasures-count,
    .cultivated-count,
    .destroyed-count {
        font-weight: bold;
        font-size: 1.1em; /* All counts same size for consistency */
    }

    /* Action buttons - minimum 2 columns for readability */
    .actions-grid {
        grid-template-columns: repeat(2, 1fr); /* Force 2 columns minimum */
        gap: var(--spacing-sm);
        max-height: 25vh; /* Limit height to allow end turn button to be visible */
        overflow-y: auto; /* Scroll if needed */
        overflow-x: hidden;
        padding-right: 2px; /* Space for scrollbar */
    }

    .action-btn {
        font-size: 1em !important;
        padding: clamp(2px, 0.4vmin, 4px) clamp(3px, 0.6vmin, 6px) !important; /* Reduced padding */
        line-height: 1.1 !important;
        white-space: normal; /* Allow text wrapping for better fit */
        overflow: hidden; /* Prevent text overflow */
        text-overflow: ellipsis;
        min-height: clamp(24px, 3.2vh, 32px) !important; /* Reduced min-height */
        word-break: break-word; /* Break long words if needed */
    }

    .btn-end-turn {
        font-weight: bold;
        background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
        position: sticky;
        bottom: 0;
        z-index: 10;
        margin-top: auto !important; /* Push to bottom */
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.3); /* Elevation effect */
        font-size: clamp(12px, 1.6vmin, 16px) !important; /* Slightly larger than other buttons */
        min-height: clamp(32px, 4vh, 44px) !important;
    }

    /* Ensure player actions section uses flexbox for proper sticky behavior */
    .player-actions-section {
        display: flex;
        flex-direction: column;
        max-height: 48vh; /* Limit total height */
        overflow: hidden; /* Prevent outer scrolling */
    }

    /* Guild grid sizing - removed width override to preserve aspect ratio */
    /* Width is already set correctly at line 4316 above */

    .guild-name {
        font-size: 0.55em;
        line-height: 1.1;
    }

    .guild-text {
        font-size: 0.45em;
        line-height: 1.1;
    }

    /* Event cards - maintain same proportions as guild cards */
    .event-card-on-board {
        /* Inherit from base styles - same as guild cards */
    }

    .event-name {
        font-size: 0.55em;
    }

    .event-deck-count {
        font-size: 0.5em;
    }

    .blocking-event-card {
        font-size: 0.45em;
    }

    /* Dice positioning - maintain same proportional position as base */
    #dice-area {
        left: 83.33%; /* (1000/1200) * 100% */
        top: 8.39%; /* (110/1311) * 100% */
        width: 12.5%; /* (150/1200) * 100% */
        height: 11.44%; /* (150/1311) * 100% */
        padding: 0;
    }

    #dice-area:not(.centered) {
        position: absolute;
        transform: none;
    }

    /* Make dice scale proportionally with viewport (which scales with board) */
    #dice-area:not(.centered) .die-container {
        width: clamp(30px, 5vmin, 60px); /* Scale with viewport */
        height: clamp(30px, 5vmin, 60px);
        aspect-ratio: 1 / 1;
    }

    #dice-area:not(.centered) .die {
        width: 100%;
        height: 100%;
        aspect-ratio: 1 / 1;
    }

    /* Adjust face positioning to scale with die size using calc */
    #dice-area:not(.centered) .die-container .face-1 {
        transform: rotateY(0deg) translateZ(clamp(15px, 2.5vmin, 30px)) !important;
    }

    #dice-area:not(.centered) .die-container .face-2 {
        transform: rotateY(90deg) translateZ(clamp(15px, 2.5vmin, 30px)) !important;
    }

    #dice-area:not(.centered) .die-container .face-3 {
        transform: rotateY(180deg) translateZ(clamp(15px, 2.5vmin, 30px)) !important;
    }

    #dice-area:not(.centered) .die-container .face-4 {
        transform: rotateY(-90deg) translateZ(clamp(15px, 2.5vmin, 30px)) !important;
    }

    #dice-area:not(.centered) .die-container .face-5 {
        transform: rotateX(90deg) translateZ(clamp(15px, 2.5vmin, 30px)) !important;
    }

    #dice-area:not(.centered) .die-container .face-6 {
        transform: rotateX(-90deg) translateZ(clamp(15px, 2.5vmin, 30px)) !important;
    }

    #dice-area:not(.centered) .die-face {
        width: 100%;
        height: 100%;
    }

    /* Font scales with die size */
    #dice-area:not(.centered) .die-face {
        font-size: clamp(10px, 2vmin, 20px);
        border-width: 1px;
    }

    #dice-area:not(.centered) #dice-display {
        gap: clamp(4px, 0.8vmin, 10px); /* Scale gap with viewport */
    }

    #dice-sum {
        font-size: clamp(16px, 2.2vmin, 26px);
    }

    /* Reposition fullscreen button to avoid hiding player info */
    .fullscreen-btn {
        top: auto;
        bottom: 10px;
        right: 10px;
        width: 36px;
        height: 36px;
        font-size: 18px;
        z-index: 1002; /* Higher than most elements but below modals */
        opacity: 0.9;
    }

    .fullscreen-btn:hover,
    .fullscreen-btn:active {
        opacity: 1;
    }

    /* Hide game log on mobile */
    #game-log-section {
        display: none;
    }

    /* Modal content */
    .modal-content {
        width: 92%;
        max-width: 400px;
        max-height: 92vh;
    }

    /* Increase modal headings for better readability */
    .modal-content h2 {
        font-size: 1.5em; /* Increased from 1.1em for "Bienvenido a Gremios" and "Selecciona la dificultad de la IA" */
    }

    /* Increase character selection heading */
    #character-selection-view h2 {
        font-size: 1.5em; /* Increased for "Selecciona tu personaje" */
    }

    .character-option,
    .guild-option,
    .difficulty-option {
        font-size: 1em; /* Increased from 0.85em for better readability */
    }

    .character-option h3,
    .difficulty-option h3 {
        font-size: 1.2em; /* Increased from 0.9em for better visibility */
    }

    .character-option p,
    .difficulty-option p {
        font-size: clamp(11px, 1.5vmin, 15px); /* Reduced for mobile landscape */
        line-height: 1.2; /* Very compact */
    }

    /* Difficulty modal - COMPACT for low-res screens */
    .modal-content {
        padding: clamp(6px, 1vmin, 15px);
        max-height: 90vh;
        overflow-y: auto;
    }

    /* Difficulty modal title - reduced */
    #difficulty-modal .modal-content h2 {
        font-size: clamp(16px, 2.8vmin, 26px) !important;
        margin-bottom: clamp(4px, 0.7vmin, 10px) !important;
        line-height: 1.15;
    }

    /* Difficulty modal subtitle - reduced */
    #difficulty-modal .modal-content p {
        font-size: clamp(13px, 2vmin, 20px) !important;
        margin-bottom: clamp(5px, 0.8vmin, 12px) !important;
        line-height: 1.25;
    }

    #difficulty-options {
        gap: clamp(5px, 0.7vmin, 10px);
    }

    .difficulty-option {
        padding: clamp(6px, 1vmin, 12px);
    }

    .difficulty-option h3 {
        font-size: clamp(13px, 1.8vmin, 18px);
        margin-bottom: clamp(3px, 0.4vmin, 6px);
    }

    /* Character description - compact and contained */
    .character-abilities {
        font-size: clamp(10px, 1.4vmin, 14px) !important;
        line-height: 1.2;
        color: #ffffff !important; /* White text */
        overflow-y: auto;
        max-height: 18vh;
        flex: 1;
    }

    .character-abilities p {
        color: #ffffff !important; /* Ensure paragraphs stay white on all zoom levels */
    }

    /* Unify character selection and in-game character display */
    #character-options-inline .character-option h3,
    .character-name {
        color: var(--color-antique-gold);
        font-size: clamp(9px, 1.3vmin, 14px) !important;
        font-weight: bold;
        line-height: 1.2;
        margin-bottom: clamp(6px, 0.8vmin, 10px) !important;
        flex-shrink: 0;
    }

    /* Character descriptions in selection - match opponent font-size */
    #character-options-inline .character-option p {
        color: #ffffff !important; /* White text */
        font-size: clamp(8px, 1.12vmin, 11.2px) !important; /* 0.8 * character-abilities size to match opponent */
        line-height: 1.3;
        overflow-y: auto;
        max-height: 100%;
        margin-bottom: 0;
        flex: 1;
    }

    /* Character option - expand to fit grid cell */
    #character-options-inline .character-option {
        overflow: hidden;
        max-height: 90%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    /* Fullscreen button */
    .fullscreen-btn {
        width: 30px;
        height: 30px;
        font-size: 16px;
    }

    /* Help modal */
    .help-section h3 {
        font-size: 0.95em;
    }

    .help-section p {
        font-size: 0.85em;
        line-height: 1.2;
    }

    .hotkey-row,
    .info-row {
        font-size: 0.75em;
        line-height: 1.2;
    }

    /* Character info - compact display */
    .character-info {
        font-size: clamp(10px, 1.3vmin, 13px) !important;
        line-height: 1.2;
        overflow-y: auto;
        max-height: 18vh;
    }

    /* Expedition card - maintain same proportions as guild cards */
    #expedition-card {
        /* Inherit from base styles - same as guild cards */
    }

    /* Treasures */
    .player-treasures {
        font-size: 0.75em;
    }

    .sell-treasure-btn {
        font-size: 0.7em;
        min-height: 20px;
    }

    /* Player names - flexible width, full text visible */
    .player-name {
        font-size: clamp(10px, 1.7vmin, 20px) !important; /* Standardized across all players */
        font-weight: bold;
        line-height: 1.1;
        overflow: visible;
        text-overflow: clip;
        white-space: nowrap; /* Single line in grid */
        word-wrap: normal;
        max-width: 100%;
    }

    /* Coins and VP - compact */
    .player-coins,
    .player-vp {
        font-size: clamp(15px, 3vmin, 28px) !important;
        font-weight: bold;
        line-height: 1.1;
        white-space: nowrap;
    }

    /* AI player sections - REDUCED sizes to prevent overlap */
    #ai-players-column .player-name {
        font-size: clamp(10px, 1.7vmin, 20px) !important; /* Standardized across all players */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        word-wrap: normal;
        font-weight: bold;
        text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.9);
        letter-spacing: 0.3px;
        max-width: 100%;
    }

    #ai-players-column .player-coins,
    #ai-players-column .player-vp {
        font-size: clamp(13px, 2.5vmin, 24px) !important;
        white-space: nowrap;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    /* Ensure coin and VP counts are prominent */
    .coin-count,
    .vp-count {
        font-size: 1em; /* Already large from parent */
        font-weight: bold;
    }

    .vp-count {
        color: #ffffff !important; /* White text for VP on mobile */
    }

    /* Unify resource display for all players - MUCH larger for visibility */
    .player-resources {
        font-size: clamp(10px, 1.4vmin, 16px) !important; /* Standardized font size */
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap; /* Keep all items in single row */
        gap: clamp(4px, 0.8vmin, 10px); /* Standardized spacing */
        margin-top: clamp(3px, 0.5vmin, 6px);
    }

    .resource-group {
        font-size: 1em;
        display: inline-flex;
        align-items: center;
        gap: clamp(3px, 0.5vmin, 6px);
        padding: clamp(4px, 0.7vmin, 8px) clamp(6px, 1vmin, 10px);
        background: rgba(0, 0, 0, 0.75);
        border-radius: 4px;
        white-space: nowrap;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .resource-label {
        font-weight: bold;
        color: #ffffff !important; /* White text for resources */
        font-size: 1em;
    }

    .lands-count,
    .inns-count,
    .treasures-count {
        font-weight: bold;
        font-size: 1.2em;
        color: #ffffff !important; /* White text for resource counts */
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    /* FORCE AI resources to be highly visible (but not grid layout) */
    #ai-players-column .player-resources:not(.ai-resources-grid) {
        font-size: clamp(10px, 1.4vmin, 16px) !important; /* Standardized font size */
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important; /* Keep all items in single row */
        gap: clamp(4px, 0.8vmin, 10px) !important; /* Standardized spacing */
        margin-top: clamp(2px, 0.3vmin, 4px) !important;
        min-height: auto !important;
        max-height: none !important;
        width: 100% !important; /* Expand to full width */
        overflow-x: auto !important; /* Allow horizontal scroll if needed */
        overflow-y: hidden !important;
    }

    #ai-players-column .resource-group {
        font-size: 0.9em !important;
        background: rgba(0, 0, 0, 0.85) !important;
        border: 2px solid rgba(201, 169, 97, 0.5) !important;
        display: inline-flex !important;
        visibility: visible !important;
        padding: clamp(2px, 0.4vmin, 5px) clamp(4px, 0.6vmin, 8px) !important;
    }

    #ai-players-column .resource-label {
        font-size: 1em !important;
        color: #ffffff !important; /* White text for AI resources */
    }

    #ai-players-column .lands-count,
    #ai-players-column .inns-count,
    #ai-players-column .treasures-count,
    #ai-players-column .cultivated-count,
    #ai-players-column .destroyed-count {
        font-size: 1.15em !important; /* All counts same size for consistency */
        color: #ffffff !important; /* White text for AI resource counts */
        font-weight: bold !important;
        display: inline !important;
    }

    .cultivated-count,
    .destroyed-count {
        color: #ffffff !important; /* White text for all players */
        opacity: 0.85;
    }

    /* Ensure resources are fully visible */
    .player-resources {
        overflow: visible;
        min-height: auto;
    }

    /* ACTION BUTTONS - TWO COLUMNS layout, reduced text size */
    .action-btn {
        font-size: clamp(10px, 1.2vmin, 13px) !important; /* Increased further */
        padding: clamp(2px, 0.4vmin, 5px) clamp(3px, 0.6vmin, 7px) !important; /* Reduced padding */
        min-height: clamp(26px, 3.5vmin, 36px);
        line-height: 1.1;
        font-weight: 600;
    }

    .actions-grid {
        gap: clamp(3px, 0.5vmin, 6px);
        grid-template-columns: 1fr 1fr !important; /* Two columns */
        grid-auto-rows: auto;
    }

    .btn-end-turn {
        font-size: clamp(12px, 2vmin, 22px) !important;
        padding: clamp(6px, 1vmin, 12px) !important;
        min-height: clamp(30px, 5vmin, 46px);
    }

    /* Player header: 3 columns in single row */
    .player-header {
        display: grid;
        grid-template-columns: 1fr auto auto; /* Name flexible, coins/VP fixed */
        align-items: baseline;  /* Use baseline for proper text alignment */
        gap: clamp(4px, 0.7vmin, 8px);
        margin-bottom: clamp(3px, 0.5vmin, 6px) !important;
        padding-bottom: clamp(2px, 0.3vmin, 4px) !important;
    }

    /* Player name - first column, flexible */
    .player-header .player-name {
        grid-column: 1;
        text-align: left;
        min-width: 0; /* Allow shrinking */
    }

    /* Coins - second column */
    .player-header .player-coins {
        grid-column: 2;
        white-space: nowrap;
    }

    /* VP - third column */
    .player-header .player-vp {
        grid-column: 3;
        white-space: nowrap;
    }

    /* AI players same layout - tighter gap to prevent overlap */
    #ai-players-column .player-header {
        display: grid;
        grid-template-columns: 1fr auto auto;
        align-items: baseline;  /* Use baseline for proper text alignment */
        gap: clamp(3px, 0.5vmin, 6px);
        padding-bottom: clamp(2px, 0.3vmin, 4px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: clamp(3px, 0.5vmin, 6px);
    }

    /* Compact coins container */
    .coins-container {
        margin-top: clamp(2px, 0.3vmin, 4px) !important;
        margin-bottom: clamp(2px, 0.3vmin, 4px) !important;
        padding: clamp(3px, 0.5vmin, 6px) !important;
        gap: clamp(2px, 0.3vmin, 4px) !important;
        min-height: clamp(40px, 8vh, 70px) !important;
    }

    /* Compact player character section */
    .player-character {
        margin-bottom: clamp(3px, 0.5vmin, 6px) !important;
    }

    #ai-players-column .player-treasures {
        font-size: 0.75em;
    }
}

/* ===========================
   EXTREME Low Resolution (400-500px height)
   =========================== */

/* For extremely small screens like 640x400 */
@media screen and (max-height: 500px) and (orientation: landscape) {
    :root {
        --base-font-size: clamp(7px, 1vmin, 16px);
        --spacing-unit: clamp(1px, 0.15vmin, 3px);
        --spacing-xs: clamp(1px, 0.15vmin, 2px);
        --spacing-sm: clamp(1px, 0.2vmin, 3px);
        --spacing-md: clamp(1px, 0.25vmin, 4px);
        --body-padding: 1px;
        --game-board-gap: clamp(1px, 0.2vmin, 2px);
        --guild-grid-min-height: clamp(120px, 28vh, 180px);
        --coin-size: clamp(18px, 3vmin, 30px); /* Proportional to placeholder size */
        --dice-size: clamp(60px, 7vmin, 80px); /* Larger minimum for proper 3D cube effect */
        --action-button-height: clamp(14px, 2vh, 20px);
        --investment-slot-size: clamp(9px, 1.2vmin, 12px);
        --guild-number-size: clamp(9px, 1.5vmin, 12px);
        --border-width: 1px;
    }

    #human-column .player-zone {
        max-height: 45vh;
    }

    /* CRITICAL: Optimized board size for extreme low-res screens (e.g., 370x200) */
    #guilds-grid {
        /* Use 94vh for extreme low-res - maximize available space */
        /* On 200px screen: height = 170px, width = 155px */
        width: min(100%, calc(94vh * 1200 / 1311));
    }

    .player-resources {
        font-size: clamp(10px, 1.4vmin, 16px); /* Standardized font size */
        gap: clamp(4px, 0.8vmin, 10px); /* Standardized spacing */
    }

    .resource-group {
        font-size: 0.9em; /* Slightly smaller */
        padding: var(--spacing-xs);
        background: rgba(0, 0, 0, 0.5);
        border-radius: var(--border-radius-sm);
    }

    .resource-label {
        font-weight: bold;
    }

    .lands-count,
    .inns-count,
    .treasures-count {
        font-weight: bold;
        font-size: 1em; /* Reduced from 1.1em */
    }

    .action-btn {
        font-size: 1.5em !important; /* Increased for better readability */
        line-height: 1.1 !important;
        white-space: normal; /* Allow wrapping on extreme low-res */
        overflow: visible;
        text-align: center;
        padding: clamp(1px, 0.3vmin, 3px) clamp(2px, 0.5vmin, 5px) !important; /* Reduced padding */
    }

    .btn-end-turn {
        font-weight: bold;
        background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
    }

    .guild-name {
        font-size: 0.5em;
    }

    .guild-text {
        font-size: 0.4em;
    }

    /* Event and expedition cards - maintain same proportions as guild cards */
    .event-card-on-board,
    #expedition-card {
        /* Inherit from base styles - same as guild cards */
    }

    /* Dice - readable even on extreme low res */
    .die-face {
        font-size: clamp(14px, 2.4vmin, 22px); /* Even larger for better readability */
        line-height: 1;
    }

    #dice-sum {
        font-size: clamp(14px, 2vmin, 22px); /* Larger sum */
    }

    .character-info {
        font-size: 0.75em;
    }

    /* Extend character info for AI opponents even more on extreme low-res */
    #ai-players-column .character-info {
        max-height: 42vh !important;
        flex: 1;
    }

    /* Override max-height during character selection to allow full image display */
    body.character-selection-phase #ai-players-column .character-info {
        max-height: none !important;
        height: 100% !important;
    }

    .sell-treasure-btn {
        font-size: 0.65em;
        min-height: 18px;
    }

    #game-log-section {
        display: none;
    }

    .fullscreen-btn {
        width: 26px;
        height: 26px;
        font-size: 14px;
    }

    /* Increase modal headings for better readability on extreme low-res */
    .modal-content h2 {
        font-size: 1.5em; /* Increased from 1em for "Bienvenido a Gremios" and "Selecciona la dificultad de la IA" */
    }

    /* Increase character selection heading for extreme low-res */
    #character-selection-view h2 {
        font-size: 1.5em; /* Increased for "Selecciona tu personaje" */
    }

    .character-option h3,
    .difficulty-option h3 {
        font-size: clamp(20px, 4vmin, 44px); /* Increased from clamp(18px, 3.5vmin, 40px) */
    }

    .character-option p,
    .difficulty-option p {
        font-size: clamp(12.8px, 2.56vmin, 28.8px); /* 0.8 * character-abilities size to match opponent */
    }

    /* Standardize character description font-size for extreme low-res */
    .character-abilities {
        font-size: clamp(16px, 3.2vmin, 36px); /* Base size - paragraphs are 0.8x this */
        line-height: 1.4;
    }

    .character-abilities p {
        color: #ffffff !important; /* Ensure paragraphs stay white on all zoom levels */
    }

    #ai-players-column .player-header {
        font-size: 0.8em;
        flex-direction: row;
        justify-content: space-between;
        align-items: baseline;  /* Use baseline for proper text alignment */
    }

    #ai-players-column .player-name {
        font-size: 1em; /* Increased from 0.85em for better visibility on extreme low-res */
    }

    #ai-players-column .player-coins,
    #ai-players-column .player-vp {
        font-size: 0.8em;
    }

    #ai-players-column .player-resources:not(.ai-resources-grid) {
        font-size: clamp(10px, 1.4vmin, 16px); /* Standardized font size */
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap; /* Keep all items in single row */
        gap: clamp(4px, 0.8vmin, 10px); /* Standardized spacing */
        width: 100%; /* Expand to full width */
        overflow-x: auto; /* Allow horizontal scroll if needed */
        overflow-y: hidden;
    }

    #ai-players-column .resource-group {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        padding: var(--spacing-xs);
        background: rgba(0, 0, 0, 0.5);
        border-radius: var(--border-radius-sm);
    }

    #ai-players-column .resource-label {
        font-weight: bold;
    }

    #ai-players-column .lands-count,
    #ai-players-column .inns-count,
    #ai-players-column .treasures-count,
    #ai-players-column .cultivated-count,
    #ai-players-column .destroyed-count {
        font-weight: bold;
        font-size: 1.1em; /* All counts same size for consistency */
    }

    #ai-players-column .player-treasures {
        font-size: 0.7em;
    }
}

/* Touch-specific optimizations */
@media (hover: none) and (pointer: coarse) {
    /* Larger touch targets for mobile */
    .action-btn {
        min-height: 44px;
    }

    .guild-card {
        min-height: 44px;
        cursor: pointer;
    }

    /* Board elements: use relative sizing to scale with board */
    .investment-slot {
        min-width: 2.5vmin; /* Scale with viewport but allow smaller on tiny screens */
        min-height: 2.5vmin;
    }

    .draggable-coin {
        min-width: 2.5vmin; /* Scale with viewport but allow smaller on tiny screens */
        min-height: 2.5vmin;
    }

    /* In mobile landscape, coins can be smaller since space is limited */
    @media screen and (max-height: 768px) and (orientation: landscape) {
        .draggable-coin {
            min-width: 2vmin;
            min-height: 2vmin;
        }

        .action-btn {
            min-height: 24px;
        }

        .guild-card {
            min-height: 30px;
        }

        .investment-slot {
            min-width: 1.5vmin;
            min-height: 1.5vmin;
        }
    }

    /* For extreme low resolution, reduce touch targets further */
    @media screen and (max-height: 500px) and (orientation: landscape) {
        .draggable-coin {
            min-width: 1.8vmin;
            min-height: 1.8vmin;
        }

        .action-btn {
            min-height: 20px;
        }

        .guild-card {
            min-height: 24px;
        }

        .investment-slot {
            min-width: 1.2vmin;
            min-height: 1.2vmin;
        }
    }

    /* Enhanced touch feedback */
    .action-btn:active {
        transform: scale(0.95);
        background: linear-gradient(135deg, #3ab4a3 0%, #2e5463 100%);
    }

    .guild-card:active {
        transform: scale(0.98);
    }

    /* Prevent text selection during drag */
    .coin-draggable,
    .guild-card,
    .action-btn {
        -webkit-user-select: none;
        user-select: none;
        -webkit-touch-callout: none;
    }

    /* Better tap targets for modals */
    .modal-content button {
        min-height: 44px;
        font-size: 1em;
    }

    /* Prevent double-tap zoom */
    button,
    .action-btn,
    .guild-card,
    .investment-slot {
        touch-action: manipulation;
    }
}

/* ===========================
   Very Small Screens (iPhone 11 Pro and similar)
   Optimizations for screens <= 480px width
   =========================== */

@media screen and (max-width: 480px) {
    /* ========================================
       ENHANCED MOBILE EXPERIENCE FOR VERY SMALL SCREENS
       ======================================== */

    /* Further enhanced modals for tiny screens */
    .modal-content {
        max-width: 98%;
        padding: 18px 14px;
    }

    .modal-content h2 {
        font-size: clamp(20px, 5vmin, 30px) !important;
        margin-bottom: 14px;
    }

    .modal-content h3 {
        font-size: clamp(17px, 4vmin, 26px) !important;
    }

    .modal-content p,
    .modal-content li {
        font-size: clamp(14px, 3.2vmin, 20px) !important;
        line-height: 1.6;
    }

    /* Character selection - larger for readability */
    .character-option {
        padding: 16px !important;
        margin-bottom: 14px !important;
    }

    .character-name {
        font-size: clamp(17px, 3.8vmin, 24px) !important;
        margin-bottom: 10px !important;
        font-weight: 700 !important;
    }

    /* Enhanced clickable character info indication */
    .character-info .character-name::after {
        content: ' ';
        font-size: 0.9em;
        opacity: 0.8;
    }

    /* Keep resources readable on tiny screens */
    .resource-icon-large {
        width: 24px !important;
        height: 24px !important;
        min-width: 24px !important;
        min-height: 24px !important;
    }

    .player-resources {
        font-size: clamp(12px, 3vmin, 17px) !important;
        gap: 5px !important;
        padding: 6px !important;
    }

    .resource-row {
        gap: 10px !important;
        margin: 4px 0 !important;
    }

    .resource-item {
        gap: 4px !important;
    }

    .resource-count {
        font-size: clamp(14px, 3.2vmin, 19px) !important;
        font-weight: 700 !important;
    }

    /* Enhanced player zones and headers */
    .player-zone {
        padding: 8px !important;
    }

    .player-zone h3 {
        font-size: clamp(16px, 3.6vmin, 24px) !important;
        margin-bottom: 8px !important;
    }

    .player-header {
        gap: 10px !important;
        padding: 10px !important;
    }

    /* Better button sizes for touch */
    .action-btn {
        min-height: 52px !important;
        padding: 12px 8px !important;
    }

    .btn-end-turn {
        min-height: 56px !important;
        padding: 16px 14px !important;
        font-size: clamp(17px, 3.6vmin, 24px) !important;
    }

    /* Guild cards more visible */
    .guild-card {
        font-size: clamp(12px, 2.8vmin, 17px) !important;
        padding: 8px !important;
        min-height: 48px !important;
    }

    .guild-card .guild-name {
        font-size: 1.15em !important;
        font-weight: 700 !important;
        margin-bottom: 5px !important;
    }

    /* Better coin display */
    .coin-icon {
        width: 22px !important;
        height: 22px !important;
        min-width: 22px !important;
        min-height: 22px !important;
    }

    /* AI players section improvements */
    #ai-players-column .player-header {
        padding: 8px !important;
        align-items: baseline;  /* Use baseline for proper text alignment */
    }

    #ai-players-column .player-name {
        font-size: clamp(13px, 3vmin, 18px) !important;
        font-weight: 700 !important;
    }

    #ai-players-column .player-coins,
    #ai-players-column .player-vp {
        font-size: clamp(12px, 2.8vmin, 17px) !important;
    }

    /* Improve actions grid spacing */
    .actions-grid {
        gap: 10px !important;
    }

    .player-actions-section {
        padding: 12px !important;
    }

    .player-actions-section h4 {
        font-size: clamp(15px, 3.4vmin, 22px) !important;
        margin-bottom: 10px !important;
    }

    /* Fullscreen and utility buttons */
    .fullscreen-btn {
        width: 54px !important;
        height: 54px !important;
        font-size: 28px !important;
    }

    .btn-utility {
        min-height: 50px !important;
        padding: 15px !important;
    }

    .btn-utility .fullscreen-icon,
    .btn-utility .help-icon {
        font-size: 28px !important;
    }

    /* Better game board spacing */
    #game-board {
        gap: 10px !important;
    }

    /* ========================================
       CHARACTER ABILITIES - SHOW IN SELECTION, HIDE IN GAME
       ======================================== */

    /* Show character abilities during selection */
    #character-modal .character-abilities,
    #character-options .character-abilities,
    #character-options-inline .character-abilities,
    #character-selection-view .character-abilities,
    .character-selection-view .character-abilities,
    .character-option .character-abilities {
        display: block !important;
        visibility: visible !important;
        height: auto !important;
        overflow: visible !important;
        max-height: none !important;
    }

    /* Hide character abilities during gameplay only */
    .player-info-view .character-abilities,
    .character-info .character-abilities,
    .player-character .character-abilities,
    #ai-player-1 .character-abilities,
    #ai-player-2 .character-abilities,
    #ai-players-column .character-abilities {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        overflow: hidden !important;
    }

    .character-info p,
    .player-info-view .character-abilities p,
    #ai-players-column .character-abilities p {
        display: none !important;
    }

    /* Make character name clickable (visual cue) */
    .character-info .character-name {
        cursor: pointer !important;
        text-decoration: underline !important;
        text-decoration-style: dotted !important;
        text-decoration-color: var(--color-antique-gold) !important;
        /* Font size inherited from earlier rule for better readability */
    }

    .character-name:hover {
        color: var(--color-antique-gold) !important;
    }

    /* Reduce character info padding */
    .character-info {
        padding: 4px !important;
        margin-top: 3px !important;
    }

    /* Maintain exact 1:2:1 ratio for small screens */
    #game-board {
        grid-template-columns: 1fr 2fr 1fr !important;  /* Always maintain 25% | 50% | 25% */
    }

    /* ========================================
       ACTION BUTTONS - MAKE TEXT MUCH BIGGER
       ======================================== */
    .action-btn {
        font-size: 1.5em !important;  /* Base size for scaling */
        padding: 12px 8px !important;
        flex-direction: column !important;
        gap: 6px !important;
        line-height: 1.1 !important;
        min-height: auto !important;
    }

    .action-text {
        font-weight: 700 !important;
        font-size: 0.8em !important;
    }

    .btn-end-turn {
        font-size: 22px !important;
        font-weight: 700 !important;
    }

    /* ========================================
       COIN ICONS IN ACTION BUTTONS - MAKE TINY
       ======================================== */
    .action-cost {
        font-size: 1.75em !important;  /* 1.75  8px = 14px */
        margin-top: 4px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 3px !important;
    }


    /* ========================================
       UTILITY BUTTONS - ICON ONLY, SAME ROW
       ======================================== */
    .btn-utility .btn-text-large,
    .btn-utility span.btn-text-large {
        display: none !important;
        visibility: hidden !important;
        font-size: 0 !important;
        width: 0 !important;
        height: 0 !important;
    }

    .btn-utility {
        padding: 14px !important;
        min-width: 50px !important;
        font-size: 0 !important;
    }

    .btn-utility .fullscreen-icon,
    .btn-utility .help-icon {
        font-size: 26px !important;
        margin: 0 !important;
        display: inline-block !important;
    }

    /* Container for utility buttons - place in same row */
    .utility-buttons-row {
        display: flex !important;
        flex-direction: row !important;
        gap: 8px !important;
        width: 100% !important;
        margin-top: 10px !important;
    }

    .utility-buttons-row .btn-utility {
        flex: 1 !important;
        margin: 0 !important;
    }

    /* ========================================
       MISC SPACING ADJUSTMENTS
       ======================================== */
    .player-zone {
        padding: 6px !important;
    }

    .player-header {
        gap: 6px !important;
    }

    .coin-icon {
        width: 18px !important;
        height: 18px !important;
    }

    .player-actions-section h4 {
        font-size: 14px !important;
        margin-bottom: 6px !important;
    }

    .actions-grid {
        gap: 6px !important;
    }
}

/* ===========================
   High Resolution Displays
   =========================== */

/* These are now handled by the CSS variable system in :root at the top of the file */
/* No additional rules needed here - variables automatically scale */

/* ===========================
   Utility Classes for Inline Styles
   =========================== */

/* Character selection title styling */
.character-selection-title {
    color: #c9a961;
}

/* Emblem badge inline for inline use */
.emblem-badge-inline {
    display: inline-block;
    animation: emblem-glow 2s ease-in-out infinite;
    filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.6));
}

/* Discoverer emblem hidden state */
.discoverer-emblem-hidden {
    display: none;
}

/* Character ability hidden state */
.character-ability-hidden {
    display: none;
}

/* Difficulty instruction text */
.difficulty-instruction {
    text-align: center;
    margin-bottom: 20px;
}

/* Modal close button */
.btn-modal-close {
    margin-top: 20px;
    width: 100%;
}

/* ========================================
   VERY SHORT SCREENS (400px height)
   Optimized for 767x340 and similar resolutions
   ======================================== */
@media screen and (max-height: 400px) {
    /* Make everything ultra-compact */
    :root {
        --spacing-xs: clamp(1px, 0.2vmin, 2px);
        --spacing-sm: clamp(1px, 0.3vmin, 3px);
        --spacing-md: clamp(2px, 0.4vmin, 4px);
        --action-button-height: clamp(18px, 2.8vh, 24px);  /* Reduced from 20-28px */
    }

    /* CRITICAL: Prioritize resources over actions at very low heights */
    body:not(.character-selection-phase) #human-column {
        grid-template-rows: auto minmax(auto, max-content) auto !important;  /* Was: auto auto 1fr */
    }

    /* Reduce human column padding */
    #human-column {
        padding: 2px !important;
    }

    /* Make player header ultra-compact */
    .player-header {
        padding: clamp(2px, 0.3vmin, 4px) !important;
        gap: clamp(2px, 0.3vmin, 4px) !important;
    }

    /* Compact player name and coins */
    .player-name {
        font-size: clamp(10px, 1.5vmin, 14px) !important;
    }

    .player-coins {
        font-size: clamp(10px, 1.5vmin, 14px) !important;
    }

    /* Compact character and resources section */
    body:not(.character-selection-phase) #human-column .player-character-and-resources {
        gap: clamp(1px, 0.2vmin, 2px) !important;
        padding: 0 !important;
    }

    .character-info {
        padding: clamp(2px, 0.3vmin, 3px) !important;
        margin: 0 !important;
    }

    .character-name {
        font-size: clamp(8px, 1.2vmin, 12px) !important;
        margin: 0 !important;
    }

    /* Ultra-compact resource icons and counts */
    .resource-icon-large,
    #player-info-view .resource-icon-large,
    .ai-player-info .resource-icon-large {
        width: clamp(14px, 2vmin, 20px) !important;
        height: clamp(14px, 2vmin, 20px) !important;
    }

    .resource-count,
    #player-info-view .resource-count,
    .ai-player-info .resource-count {
        font-size: clamp(9px, 1.4vmin, 14px) !important;
        min-width: clamp(12px, 1.8vmin, 18px) !important;
    }

    .resource-row {
        gap: clamp(2px, 0.5vmin, 4px) !important;  /* Reduced from 4-8px */
        margin: 0 !important;  /* Removed margin */
    }

    .resource-item {
        gap: clamp(2px, 0.3vmin, 3px) !important;  /* Reduced from 2-4px */
    }

    /* Compact treasure detail row - CRITICAL FOR VISIBILITY */
    #human-treasures-detail {
        margin-top: 0 !important;  /* Remove top margin */
        gap: clamp(2px, 0.3vmin, 3px) !important;  /* Reduced gap */
    }

    /* ENSURE treasure breakdown is always visible */
    .treasure-breakdown-row {
        overflow: visible !important;  /* Override parent clipping */
        position: relative !important;
        z-index: 10 !important;  /* Stay on top */
        min-height: 16px !important;  /* Guarantee visibility */
        margin: 0 !important;
    }

    .treasure-breakdown-inline {
        gap: clamp(2px, 0.4vmin, 4px) !important;  /* Compact spacing */
        padding: clamp(2px, 0.3vmin, 3px) !important;  /* Reduced padding */
    }

    .resource-icon-small {
        width: clamp(16px, 2.2vmin, 20px) !important;  /* Increased for visibility */
        height: clamp(16px, 2.2vmin, 20px) !important;
    }

    .resource-count-small {
        font-size: clamp(11px, 1.6vmin, 14px) !important;  /* Increased for readability */
        font-weight: bold !important;
        min-width: clamp(16px, 2vmin, 22px) !important;  /* Ensure count has space */
    }

    /* CRITICAL: Make sell buttons visible and tappable */
    .sell-treasure-btn {
        padding: 2px 5px !important;  /* Increased from 1px 3px */
        font-size: clamp(9px, 1.4vmin, 12px) !important;  /* Increased from 7-10px */
        min-width: 25px !important;  /* Ensure tappable width */
        min-height: 13px !important;  /* Ensure tappable height */
        line-height: 1 !important;
        white-space: nowrap !important;
    }

    /* Compact action buttons section - minimize vertical space */
    .player-actions-section {
        padding: 1px !important;  /* Minimal padding */
        gap: 0 !important;  /* No gap */
    }

    .player-actions-section h4 {
        font-size: clamp(9px, 1.4vmin, 13px) !important;
        margin: 0 !important;  /* Remove all margin */
        padding-bottom: 1px !important;
    }

    /* Make action buttons much smaller and more compact */
    .actions-grid {
        grid-template-columns: repeat(auto-fit, minmax(clamp(50px, 9vw, 85px), 1fr)) !important;  /* Reduced from 55px */
        gap: 1px !important;  /* Minimal gap */
    }

    .action-btn {
        font-size: clamp(7px, 1.2vmin, 11px) !important;
        padding: clamp(0.15em, 0.4vmin, 0.4em) !important;  /* Reduced padding */
        min-height: clamp(18px, 2.8vh, 24px) !important;  /* Reduced from 20-28px */
        line-height: 1.05 !important;  /* Tighter line height */
    }

    .btn-end-turn {
        font-size: clamp(8px, 1.4vmin, 13px) !important;
    }

    /* Compact utility buttons */
    .utility-buttons-row {
        gap: clamp(2px, 0.3vmin, 4px) !important;
        margin-top: clamp(2px, 0.3vmin, 4px) !important;
        padding: clamp(1px, 0.2vmin, 2px) 0 !important;
    }

    .btn-utility {
        font-size: clamp(7px, 1.2vmin, 11px) !important;
        padding: clamp(0.2em, 0.5vmin, 0.5em) !important;
        min-height: clamp(18px, 2.5vh, 24px) !important;
    }

    .btn-utility .fullscreen-icon,
    .btn-utility .help-icon {
        font-size: 1.1em !important;
        margin-right: 2px !important;
    }

    /* Ensure actions section is scrollable */
    body:not(.character-selection-phase) #human-column .player-actions-section {
        overflow-y: auto !important;
        overflow-x: hidden !important;
        max-height: none !important;
    }

    /* Compact AI players column */
    #ai-players-column {
        padding: clamp(2px, 0.3vmin, 4px) !important;
        gap: clamp(4px, 0.6vmin, 8px) !important;
    }

    .ai-player-header {
        padding: clamp(1px, 0.2vmin, 3px) clamp(2px, 0.3vmin, 4px) !important;
        gap: clamp(1px, 0.2vmin, 2px) !important;
    }

    .ai-player-info {
        padding: clamp(2px, 0.3vmin, 4px) !important;
    }
}

/* ========================================
   ULTRA-LOW HEIGHT VIEWPORTS (270-279px)
   For minimum supported resolutions like 480x270
   Applies to ANY width >= 480px with low height
   ======================================== */
@media screen and (min-width: 480px) and (min-height: 270px) and (max-height: 279px) {
    /* Ultra-compact grid allocation */
    body:not(.character-selection-phase) #human-column {
        grid-template-rows: minmax(0, 6vh) minmax(0, 22vh) 1fr !important;  /* Header 6vh, Resources 22vh, Actions rest */
        gap: 0 !important;
        padding: 2px !important;
    }

    /* Minimal player header */
    body:not(.character-selection-phase) #human-column .player-header {
        max-height: 6vh !important;
        min-height: 0 !important;
        padding: 2px !important;
        gap: 2px !important;
        overflow: hidden !important;
        margin: 0 !important;
    }

    .player-name {
        font-size: clamp(9px, 1.4vmin, 14px) !important;
    }

    .player-coins {
        font-size: clamp(9px, 1.4vmin, 14px) !important;
    }

    /* Ultra-constrained resources section */
    body:not(.character-selection-phase) #human-column .player-character-and-resources {
        gap: 1px !important;
        padding: 2px !important;
        margin: 0 !important;
        max-height: calc(22vh - 10px) !important;  /* Extra buffer for ultra-low heights */
        overflow-y: auto !important;
        overflow-x: hidden !important;
        min-height: 0 !important;
    }

    /* Compact character info */
    .character-info {
        padding: 2px !important;
        margin: 0 !important;
    }

    .character-name {
        font-size: clamp(8px, 1.2vmin, 12px) !important;
        margin: 0 !important;
    }

    .character-ability {
        font-size: clamp(7px, 1vmin, 10px) !important;
    }

    /* Minimal resource icons */
    .resource-icon-large,
    #player-info-view .resource-icon-large {
        width: clamp(14px, 2vmin, 20px) !important;
        height: clamp(14px, 2vmin, 20px) !important;
    }

    .resource-count,
    #player-info-view .resource-count {
        font-size: clamp(9px, 1.3vmin, 14px) !important;
        min-width: clamp(12px, 1.8vmin, 18px) !important;
    }

    /* Minimal actions section */
    body:not(.character-selection-phase) #human-column .player-actions-section {
        min-height: 100px !important;
        gap: 1px !important;
        padding: 2px !important;
        margin: 0 !important;
        overflow: hidden !important;
    }

    .player-actions-section h4 {
        font-size: clamp(9px, 1.4vmin, 12px) !important;
        margin: 0 0 2px 0 !important;
        padding: 0 !important;
    }

    /* Compact action buttons */
    .actions-grid {
        grid-template-columns: repeat(auto-fit, minmax(clamp(50px, 9vw, 80px), 1fr)) !important;
        gap: 1px !important;
    }

    .action-btn {
        font-size: clamp(7px, 1.2vmin, 11px) !important;
        padding: clamp(0.2em, 0.4vmin, 0.5em) !important;
        min-height: clamp(20px, 3vh, 28px) !important;
        line-height: 1 !important;
    }

    /* Ensure critical buttons remain visible */
    .btn-end-turn {
        font-size: clamp(8px, 1.4vmin, 13px) !important;
        min-height: 32px !important;  /* Minimum for ultra-low */
        padding: clamp(0.3em, 0.5vmin, 0.6em) !important;
    }

    .utility-buttons-row {
        gap: 2px !important;
        margin-top: 2px !important;
        padding: 1px 0 !important;
    }

    .btn-utility {
        font-size: clamp(7px, 1.2vmin, 11px) !important;
        padding: clamp(0.2em, 0.4vmin, 0.5em) !important;
        min-height: 28px !important;  /* Minimum for ultra-low */
    }

    .btn-utility .fullscreen-icon,
    .btn-utility .help-icon {
        font-size: 1.2em !important;
        margin-right: 2px !important;
    }
}

/* ========================================
   LOW-HEIGHT LANDSCAPE VIEWPORTS (280-400px)
   Applies to ANY width >= 500px with low height
   ======================================== */
@media screen and (min-width: 500px) and (min-height: 280px) and (max-height: 400px) {
    /* Reduce human column header space allocation - use minmax to limit space more strictly */
    body:not(.character-selection-phase) #human-column {
        grid-template-rows: minmax(0, 8vh) minmax(0, 28vh) 1fr !important;  /* Header max 8vh, Resources max 28vh, Actions takes rest */
        gap: 0 !important;  /* Remove gap between grid rows to prevent overlap */
        padding: clamp(2px, 0.3vmin, 4px) !important;
    }

    /* Compact player header */
    body:not(.character-selection-phase) #human-column .player-header {
        max-height: 8vh !important;
        min-height: 0 !important;
        padding: clamp(2px, 0.4vmin, 5px) !important;
        gap: clamp(2px, 0.4vmin, 5px) !important;
        overflow: hidden !important;
        margin: 0 !important;  /* Remove margins */
    }

    .player-name {
        font-size: clamp(10px, 1.6vmin, 16px) !important;
    }

    .player-coins {
        font-size: clamp(10px, 1.6vmin, 16px) !important;
    }

    /* CRITICAL: Constrain character and resources section to prevent overlap */
    body:not(.character-selection-phase) #human-column .player-character-and-resources {
        gap: clamp(1px, 0.2vh, 3px) !important;
        padding: clamp(1px, 0.2vh, 3px) !important;
        margin: 0 !important;  /* Remove margins */
        max-height: calc(28vh - 8px) !important;  /* Strict height limit with buffer to prevent overlap */
        overflow-y: auto !important;  /* Allow scrolling if content exceeds */
        overflow-x: hidden !important;
        min-height: 0 !important;
    }

    /* Reduce min-height for actions section to fit buttons */
    body:not(.character-selection-phase) #human-column .player-actions-section {
        min-height: 120px !important;  /* Reduced from 150px to allow more space for resources */
        gap: clamp(1px, 0.2vh, 3px) !important;
        padding: clamp(1px, 0.2vh, 3px) !important;
        margin: 0 !important;  /* Remove margins */
        overflow: hidden !important;  /* Prevent actions from overflowing */
    }

    .character-info {
        padding: clamp(3px, 0.5vmin, 6px) !important;
        margin: 0 !important;
    }

    .character-name {
        font-size: clamp(9px, 1.4vmin, 14px) !important;
        margin: 0 !important;
    }

    .character-ability {
        font-size: clamp(8px, 1.2vmin, 12px) !important;
    }

    /* Reduce resource icon and count sizes */
    .resource-icon-large,
    #player-info-view .resource-icon-large {
        width: clamp(16px, 2.2vmin, 24px) !important;
        height: clamp(16px, 2.2vmin, 24px) !important;
    }

    .resource-count,
    #player-info-view .resource-count {
        font-size: clamp(10px, 1.5vmin, 16px) !important;
        min-width: clamp(14px, 2vmin, 20px) !important;
    }

    .resource-row {
        gap: clamp(3px, 0.5vmin, 6px) !important;
        margin: clamp(1px, 0.2vh, 3px) 0 !important;
    }

    .resource-item {
        gap: clamp(2px, 0.4vmin, 4px) !important;
    }

    /* Compact treasure sections */
    #human-treasures-detail {
        margin-top: clamp(2px, 0.3vh, 4px) !important;
        gap: clamp(2px, 0.3vh, 4px) !important;
    }

    .treasure-breakdown-inline {
        gap: clamp(2px, 0.4vmin, 5px) !important;
        padding: clamp(2px, 0.4vmin, 4px) !important;
    }

    .resource-icon-small {
        width: clamp(16px, 2.2vmin, 22px) !important;
        height: clamp(16px, 2.2vmin, 22px) !important;
    }

    .resource-count-small {
        font-size: clamp(10px, 1.5vmin, 15px) !important;
        min-width: clamp(14px, 2vmin, 20px) !important;
    }

    /* Actions section heading */
    .player-actions-section h4 {
        font-size: clamp(10px, 1.5vmin, 14px) !important;
        margin: 0 0 clamp(2px, 0.3vh, 4px) 0 !important;
        padding: 0 !important;
    }

    /* Action buttons grid */
    .actions-grid {
        grid-template-columns: repeat(auto-fit, minmax(clamp(55px, 10vw, 90px), 1fr)) !important;
        gap: clamp(2px, 0.3vh, 4px) !important;
    }

    /* Action buttons - maintain minimum usable size */
    .action-btn {
        font-size: clamp(8px, 1.3vmin, 13px) !important;
        padding: clamp(0.25em, 0.5vmin, 0.6em) !important;
        min-height: clamp(22px, 3.2vh, 32px) !important;
        line-height: 1.1 !important;
    }

    /* End Turn button - ensure visibility */
    .btn-end-turn {
        font-size: clamp(9px, 1.5vmin, 15px) !important;
        min-height: 36px !important;  /* Ensure always visible */
        padding: clamp(0.3em, 0.6vmin, 0.7em) clamp(0.5em, 1vmin, 1.2em) !important;
    }

    /* Utility buttons row */
    .utility-buttons-row {
        gap: clamp(3px, 0.4vmin, 6px) !important;
        margin-top: clamp(3px, 0.4vh, 5px) !important;
        padding: clamp(2px, 0.3vh, 4px) 0 !important;
    }

    /* Utility buttons - maintain minimum usable size */
    .btn-utility {
        font-size: clamp(8px, 1.3vmin, 13px) !important;
        padding: clamp(0.3em, 0.5vmin, 0.6em) clamp(0.5em, 0.8vmin, 1em) !important;
        min-height: 32px !important;  /* Ensure always visible */
    }

    .btn-utility .fullscreen-icon,
    .btn-utility .help-icon {
        font-size: 1.2em !important;
        margin-right: clamp(2px, 0.4vmin, 4px) !important;
    }

    /* Reduce AI players column spacing */
    #ai-players-column {
        padding: clamp(3px, 0.4vmin, 6px) !important;
        gap: clamp(4px, 0.6vmin, 10px) !important;
    }

    .ai-player-header {
        padding: clamp(2px, 0.3vmin, 5px) clamp(3px, 0.4vmin, 6px) !important;
        gap: clamp(2px, 0.3vmin, 4px) !important;
    }

    .ai-player-info {
        padding: clamp(3px, 0.4vmin, 6px) !important;
    }

    .ai-player-name {
        font-size: clamp(10px, 1.5vmin, 15px) !important;
    }

    .ai-coins {
        font-size: clamp(10px, 1.5vmin, 15px) !important;
    }
}

/* ===========================
   MENU SYSTEM STYLES
   =========================== */

/* CSS Variables for transition speeds (can be modified by MenuController) */
:root {
    --transition-duration: 0.3s;
    --animation-duration: 0.6s;
}

/* Hide game board when in menu mode */
body.menu-active #game-container > #game-board {
    display: none;
}

body.menu-active #game-log-section {
    display: none;
}

/* Loading Screen */
#loading-screen-modal {
    z-index: 10000;
}

.loading-screen-content {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #000;
}

#intro-video {
    position: absolute;
    top: 50%;
    left: 50%;
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    transform: translate(-50%, -50%);
    object-fit: contain;
    z-index: 1;
}

.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.6) 0%,
        rgba(0, 0, 0, 0.4) 50%,
        rgba(0, 0, 0, 0.7) 100%
    );
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 2;
    padding: 20px;
}

.game-title {
    font-size: clamp(48px, 8vw, 96px);
    font-weight: bold;
    color: var(--gold-primary);
    text-shadow:
        0 0 10px rgba(201, 169, 97, 0.5),
        2px 2px 4px rgba(0, 0, 0, 0.8),
        0 0 30px rgba(201, 169, 97, 0.3);
    margin-bottom: 60px;
    letter-spacing: 8px;
    animation: titlePulse var(--animation-duration) ease-in-out infinite alternate;
    transition: opacity 0.3s ease-out;
}

@keyframes titlePulse {
    0% {
        text-shadow:
            0 0 10px rgba(201, 169, 97, 0.5),
            2px 2px 4px rgba(0, 0, 0, 0.8),
            0 0 30px rgba(201, 169, 97, 0.3);
    }
    100% {
        text-shadow:
            0 0 20px rgba(201, 169, 97, 0.8),
            2px 2px 4px rgba(0, 0, 0, 0.8),
            0 0 50px rgba(201, 169, 97, 0.5);
    }
}

.loading-bar-container {
    width: 100%;
    max-width: 500px;
    text-align: center;
    transition: opacity 0.3s ease-out;
}

.loading-bar {
    width: 100%;
    height: 30px;
    background: rgba(0, 0, 0, 0.5);
    border: 2px solid var(--gold-primary);
    border-radius: 15px;
    overflow: hidden;
    box-shadow:
        0 0 10px rgba(201, 169, 97, 0.3),
        inset 0 2px 4px rgba(0, 0, 0, 0.5);
}

.loading-progress {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,
        var(--gold-primary) 0%,
        #dac272 50%,
        var(--gold-primary) 100%
    );
    transition: width var(--transition-duration) ease-out;
    box-shadow: 0 0 15px rgba(201, 169, 97, 0.6);
}

.loading-text {
    margin-top: 15px;
    font-size: clamp(16px, 3vw, 24px);
    color: var(--gold-primary);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    font-weight: 600;
}

.skip-btn {
    position: absolute;
    bottom: 40px;
    right: 40px;
    padding: 12px 24px;
    font-size: 18px;
    transition: all var(--transition-duration) ease;
}

.skip-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(201, 169, 97, 0.5);
}

/* Menu Modal Content */
.menu-modal-content {
    text-align: center;
    padding: 40px;
    min-width: 400px;
    max-width: 600px;
}

.main-menu-title {
    font-size: clamp(42px, 6vw, 72px);
    color: var(--gold-primary);
    margin-bottom: 50px;
    text-shadow:
        2px 2px 4px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(201, 169, 97, 0.3);
    letter-spacing: 6px;
}

.menu-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
    width: 100%;
}

.menu-btn {
    width: 100%;
    max-width: 350px;
    padding: 18px 32px;
    font-size: clamp(18px, 3vw, 24px);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all var(--transition-duration) ease;
    border: 2px solid var(--gold-primary);
    margin: 0 auto;
}

.menu-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(201, 169, 97, 0.4);
}

.menu-btn:active {
    transform: translateY(-1px);
}

.menu-button-wrapper {
    display: flex;
    justify-content: center;
    width: 100%;
}

/* Settings Panel */
.settings-panel {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid var(--gold-primary);
    border-radius: var(--border-radius-md);
    padding: 30px;
    margin-bottom: 30px;
    text-align: left;
}

.setting-item {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
}

.setting-item label {
    font-size: 18px;
    font-weight: 600;
    color: var(--gold-primary);
}

/* Custom Select Styling */
.custom-select-wrapper {
    position: relative;
    width: 100%;
}

.custom-select-display {
    padding: 12px 20px;
    font-size: 16px;
    background: rgba(0, 0, 0, 0.6);
    color: var(--gold-primary);
    border: 2px solid var(--gold-primary);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: all var(--transition-duration) ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.custom-select-display::after {
    content: '';
    font-size: 12px;
    margin-left: 10px;
    transition: transform var(--transition-duration) ease;
}

.custom-select-display:hover {
    background: rgba(201, 169, 97, 0.2);
    box-shadow: 0 0 10px rgba(201, 169, 97, 0.3);
}

.custom-select-options {
    position: absolute;
    top: calc(100% + 5px);
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.9);
    border: 2px solid var(--gold-primary);
    border-radius: var(--border-radius-sm);
    overflow: hidden;
    z-index: 1000;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.custom-select-options.hidden {
    display: none;
}

.custom-option {
    padding: 12px 20px;
    font-size: 16px;
    color: var(--gold-primary);
    cursor: pointer;
    transition: all var(--transition-duration) ease;
    border-bottom: 1px solid rgba(201, 169, 97, 0.2);
}

.custom-option:last-child {
    border-bottom: none;
}

.custom-option:hover {
    background: rgba(201, 169, 97, 0.3);
}

.custom-option.selected {
    background: rgba(201, 169, 97, 0.2);
    font-weight: 700;
}

.setting-description {
    font-size: 14px;
    color: rgba(201, 169, 97, 0.8);
    font-style: italic;
    margin-top: -5px;
}

/* Credits Content */
.credits-content {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid var(--gold-primary);
    border-radius: var(--border-radius-md);
    padding: 30px;
    margin-bottom: 30px;
    text-align: left;
}

.credits-text {
    font-size: 18px;
    line-height: 1.8;
    color: var(--text-primary);
    margin-bottom: 20px;
}

.credits-text:last-child {
    margin-bottom: 0;
}

.credits-text strong {
    color: var(--gold-primary);
    font-weight: 700;
}

.credits-text a {
    color: var(--gold-primary);
    text-decoration: none;
    border-bottom: 1px solid var(--gold-primary);
    transition: all var(--transition-duration) ease;
}

.credits-text a:hover {
    color: #dac272;
    border-bottom-color: #dac272;
    text-shadow: 0 0 8px rgba(201, 169, 97, 0.5);
}

/* Responsive adjustments for menu system */
@media screen and (max-width: 768px) {
    .menu-modal-content {
        min-width: 300px;
        padding: 30px 20px;
    }

    .main-menu-title {
        margin-bottom: 40px;
    }

    .menu-btn {
        padding: 15px 24px;
        font-size: clamp(16px, 4vw, 20px);
    }

    .settings-panel,
    .credits-content {
        padding: 20px;
    }

    .credits-text {
        font-size: 16px;
    }

    .skip-btn {
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        font-size: 16px;
    }
}

@media screen and (max-width: 480px) {
    .menu-modal-content {
        min-width: 90%;
        padding: 20px 15px;
    }

    .loading-bar-container {
        max-width: 90%;
    }

    .game-title {
        margin-bottom: 40px;
        letter-spacing: 4px;
    }

    .menu-btn {
        padding: 12px 20px;
    }

    .settings-panel,
    .credits-content {
        padding: 15px;
    }

    .setting-item {
        gap: 8px;
    }

    .setting-item label {
        font-size: 16px;
    }

    .custom-select-display,
    .custom-option {
        font-size: 14px;
        padding: 10px 15px;
    }

    .credits-text {
        font-size: 14px;
    }
}

/* Landscape mobile optimization for loading screen */
@media screen and (max-height: 500px) and (orientation: landscape) {
    .game-title {
        font-size: clamp(32px, 6vw, 48px);
        margin-bottom: 30px;
    }

    .loading-bar {
        height: 20px;
    }

    .skip-btn {
        bottom: 15px;
        right: 15px;
        padding: 8px 16px;
        font-size: 14px;
    }
}

/* Landscape menu optimization - Moderate heights */
@media screen and (max-height: 600px) and (orientation: landscape) {
    .modal {
        padding: 20px 20px;
    }

    .menu-modal-content {
        padding: 25px;
    }

    .main-menu-title {
        font-size: clamp(36px, 5vw, 60px);
        margin-bottom: 25px;
    }

    .menu-modal-content h2 {
        font-size: clamp(28px, 4vw, 48px);
        margin-bottom: 20px;
    }

    .menu-buttons-container {
        gap: 15px;
    }

    .menu-btn {
        padding: 12px 24px;
        font-size: 16px;
    }

    .settings-panel,
    .credits-content {
        padding: 20px;
        margin-bottom: 20px;
    }

    .setting-item {
        margin-bottom: 15px;
    }

    .setting-description {
        font-size: 13px;
        margin-top: 10px;
    }

    .credits-text {
        font-size: 14px;
        line-height: 1.5;
    }
}

/* Landscape menu optimization - Small heights */
@media screen and (max-height: 500px) and (orientation: landscape) {
    .modal {
        padding: 15px 20px;
    }

    .menu-modal-content {
        padding: 15px;
    }

    .main-menu-title {
        font-size: clamp(32px, 4.5vw, 52px);
        margin-bottom: 15px;
    }

    .menu-modal-content h2 {
        font-size: clamp(24px, 3.5vw, 42px);
        margin-bottom: 15px;
    }

    .menu-buttons-container {
        gap: 10px;
    }

    .menu-btn {
        padding: 10px 20px;
        font-size: 15px;
    }

    .settings-panel,
    .credits-content {
        padding: 15px;
        margin-bottom: 15px;
    }

    .setting-item {
        margin-bottom: 10px;
    }

    .setting-description {
        font-size: 12px;
        margin-top: 8px;
    }

    .credits-text {
        font-size: 13px;
        line-height: 1.4;
        margin-bottom: 10px;
    }

    .custom-select-wrapper {
        font-size: 14px;
    }

    .custom-select-display,
    .custom-option {
        padding: 8px 12px;
        font-size: 14px;
    }
}

/* Landscape menu optimization - Very small heights */
@media screen and (max-height: 400px) and (orientation: landscape) {
    .modal {
        padding: 10px 15px;
    }

    .menu-modal-content {
        padding: 12px;
    }

    .main-menu-title {
        font-size: clamp(28px, 4vw, 46px);
        margin-bottom: 10px;
    }

    .menu-modal-content h2 {
        font-size: clamp(22px, 3vw, 36px);
        margin-bottom: 10px;
    }

    .menu-buttons-container {
        gap: 8px;
    }

    .menu-btn {
        padding: 8px 16px;
        font-size: 14px;
    }

    .settings-panel,
    .credits-content {
        padding: 12px;
        margin-bottom: 10px;
    }

    .setting-item {
        margin-bottom: 8px;
    }

    .setting-item label {
        font-size: 13px;
        margin-bottom: 6px;
    }

    .setting-description {
        font-size: 11px;
        margin-top: 6px;
    }

    .credits-text {
        font-size: 12px;
        line-height: 1.3;
        margin-bottom: 8px;
    }

    .custom-select-wrapper {
        font-size: 13px;
    }

    .custom-select-display,
    .custom-option {
        padding: 6px 10px;
        font-size: 13px;
    }

    .menu-button-wrapper {
        margin-top: 10px;
    }
}
